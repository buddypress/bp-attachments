{"mappings":"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","sources":["src/blocks/file-attachment/block.json","src/blocks/common/components/attachment-placeholder.js","src/blocks/file-attachment/js/edit.js","src/blocks/file-attachment/js/index.js"],"sourcesContent":["{\n\t\"$schema\": \"https://schemas.wp.org/trunk/block.json\",\n\t\"apiVersion\": 2,\n\t\"version\": \"1.0.0\",\n\t\"name\": \"bp/file-attachment\",\n\t\"title\": \"File\",\n\t\"category\": \"community-media\",\n\t\"icon\": \"media-text\",\n\t\"description\": \"Insert a file from your personal media library.\",\n\t\"keywords\": [ \"BuddyPress\", \"community\", \"file\", \"media\" ],\n\t\"textdomain\": \"bp-attachments\",\n\t\"attributes\": {\n\t\t\"align\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"url\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"name\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"mediaType\": {\n\t\t\t\"type\": \"string\"\n\t\t}\n\t},\n\t\"supports\": {\n\t\t\"alignWide\": false,\n\t\t\"anchor\": false,\n\t\t\"html\": false\n\t},\n\t\"editorScript\": \"file:./bp-attachments/assets/blocks/file-attachment/js/index.js\",\n\t\"style\": \"file:./bp-attachments/assets/blocks/file-attachment/css/index.css\"\n}\n","/**\n * WordPress dependencies.\n */\nconst {\n\tapiFetch,\n\tcomponents: {\n\t\tDropZone,\n\t\tFormFileUpload,\n\t\tNotice,\n\t\tPlaceholder,\n\t},\n\tdata: {\n\t\tuseSelect,\n\t},\n\telement: {\n\t\tcreateElement,\n\t\tuseState,\n\t},\n\ti18n: {\n\t\t__,\n\t},\n} = wp;\n\n/**\n * BP Attachments blocks placeholder to upload files.\n *\n * @since 1.0.0\n *\n * @param {string} type The allowed media type.\n * @param {string} icon The dashicon name.\n * @param {string} label The label to use.\n */\nconst AttachmentPlaceholder = ( { type, icon, label, onSetAttributes } ) => {\n\tconst {\n\t\tbpAttachments: {\n\t\t\tallowedExtByMediaList,\n\t\t\tallowedExtTypes,\n\t\t\tmimeTypeImageBaseUrl,\n\t\t},\n\t} = useSelect( ( select ) => {\n\t\treturn select( 'core/editor' ).getEditorSettings();\n\t}, [] );\n\tconst extList = allowedExtByMediaList[ type + '_playlist' ] ? allowedExtByMediaList[ type + '_playlist' ] : allowedExtByMediaList.album;\n\tconst allowedTypes = 'any' === type ? allowedExtTypes : extList;\n\tconst [ errorMessage, setErrorMessage ] = useState( '' );\n\tconst { userId, postId } = useSelect( ( select ) => {\n\t\tconst currentUser = select( 'core' ).getCurrentUser();\n\n\t\treturn {\n\t\t\tuserId: currentUser.id,\n\t\t\tpostId: select( 'core/editor' ).getCurrentPostId(),\n\t\t};\n\t}, [] );\n\n\tconst onUploadedMedium = ( file ) => {\n\t\tconst formData = new FormData();\n\t\tformData.append( 'file', file );\n\t\tformData.append( 'action', 'bp_attachments_media_upload' );\n\t\tformData.append( 'object', 'members' );\n\t\tformData.append( 'object_item', userId );\n\t\tformData.append( 'visibility', 'public' );\n\n\t\tif ( !! postId ) {\n\t\t\tformData.append( 'attached_to_object_type', 'post' );\n\t\t\tformData.append( 'attached_to_object_id', postId );\n\t\t}\n\n\t\t// Reset error message.\n\t\tsetErrorMessage( '' );\n\n\t\tapiFetch( {\n\t\t\tpath: 'buddypress/v1/attachments',\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData,\n\t\t} ).then( ( response ) => {\n\t\t\tif ( response.links && response.links.src ) {\n\t\t\t\tif ( 'any' === type ) {\n\t\t\t\t\tonSetAttributes( {\n\t\t\t\t\t\turl: response.links.view,\n\t\t\t\t\t\tname: response.title,\n\t\t\t\t\t\tmediaType: response.icon.replace( mimeTypeImageBaseUrl, '' ).replace( '.png', '' ),\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tonSetAttributes( {\n\t\t\t\t\t\turl: response.links.view,\n\t\t\t\t\t\tsrc: response.links.src,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t} ).catch( ( error ) => {\n\t\t\tif ( error.message ) {\n\t\t\t\tconst errorMessage = (\n\t\t\t\t\t<Notice status=\"error\" isDismissible={ false }>\n\t\t\t\t\t\t<p>{ error.message }</p>\n\t\t\t\t\t</Notice>\n\t\t\t\t);\n\n\t\t\t\tsetErrorMessage( errorMessage );\n\t\t\t}\n\t\t} );\n\t}\n\n\tconst uploadMedia = ( files ) => {\n\t\tlet media;\n\n\t\tif ( files.currentTarget && files.currentTarget.files ) {\n\t\t\tmedia = [ ...files.currentTarget.files ];\n\t\t} else {\n\t\t\tmedia = files;\n\t\t}\n\n\t\t// Using only one medium.\n\t\tconst medium = media[0];\n\t\tonUploadedMedium( medium );\n\t}\n\n\treturn (\n\t\t<Placeholder\n\t\t\ticon={ !! icon ? icon : 'admin-media' }\n\t\t\tlabel={ !! label ? label : __( 'Community Media', 'bp-attachments' ) }\n\t\t\tisColumnLayout={ true }\n\t\t\tclassName=\"bp-attachments-media-placeholder\"\n\t\t>\n\t\t\t<DropZone\n\t\t\t\tonFilesDrop={ ( files ) => uploadMedia( files ) }\n\t\t\t\tclassName=\"uploader-inline\"\n\t\t\t/>\n\t\t\t<FormFileUpload\n\t\t\t\tonChange={ ( files ) => uploadMedia( files ) }\n\t\t\t\tmultiple={ false }\n\t\t\t\taccept={ allowedTypes }\n\t\t\t\tclassName=\"components-button block-editor-media-placeholder__button block-editor-media-placeholder__upload-button is-primary\"\n\t\t\t>\n\t\t\t\t{ __( 'Select a file', 'bp-attachments' ) }\n\t\t\t</FormFileUpload>\n\t\t\t{ errorMessage }\n\t\t</Placeholder>\n\t);\n};\n\nexport default AttachmentPlaceholder;\n","/**\n * WordPress dependencies.\n */\nconst {\n\tblockEditor: {\n\t\tBlockAlignmentControl,\n\t\tBlockControls,\n\t\tuseBlockProps,\n\t\tRichText,\n\t},\n\tdata: {\n\t\tuseSelect,\n\t},\n\telement: {\n\t\tcreateElement,\n\t\tFragment,\n\t},\n\ti18n: {\n\t\t__,\n\t},\n} = wp;\n\n/**\n * Internal dependencies.\n */\nimport AttachmentPlaceholder from '../../common/components/attachment-placeholder';\n\nconst editFile = ( { attributes, setAttributes } ) => {\n\tconst {\n\t\tbpAttachments: {\n\t\t\tmimeTypeImageBaseUrl,\n\t\t},\n\t} = useSelect( ( select ) => {\n\t\treturn select( 'core/editor' ).getEditorSettings();\n\t}, [] );\n\tconst { align, name, url, mediaType } = attributes;\n\tconst blockProps = useBlockProps( {\n\t\tclassName: !! align && undefined !== align ? 'wp-block-bp-file-attachment align' + align : 'wp-block-bp-file-attachment',\n\t} );\n\n\tif ( ! url ) {\n\t\treturn (\n\t\t\t<figure { ...blockProps }>\n\t\t\t\t<AttachmentPlaceholder\n\t\t\t\t\ttype=\"any\"\n\t\t\t\t\ticon=\"media-text\"\n\t\t\t\t\tlabel={ __( 'Community File', 'bp-attachments' ) }\n\t\t\t\t\tonSetAttributes={ setAttributes }\n\t\t\t\t/>\n\t\t\t</figure>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Fragment>\n\t\t\t<BlockControls group=\"block\">\n\t\t\t\t<BlockAlignmentControl\n\t\t\t\t\tcontrols={ [ 'none', 'left', 'center', 'right' ] }\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ ( alignment ) => setAttributes( { align: alignment } ) }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t\t<div { ...blockProps }>\n\t\t\t\t<div className=\"bp-attachment-file-icon\">\n\t\t\t\t\t<img src={ mimeTypeImageBaseUrl + mediaType + '.png' } />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"bp-attachment-file-content\">\n\t\t\t\t\t<div className=\"bp-attachment-file-title\">\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\ttagName=\"a\"\n\t\t\t\t\t\t\tvalue={ name }\n\t\t\t\t\t\t\tplaceholder={ __( 'Write file nameâ€¦', 'bp-attachments' ) }\n\t\t\t\t\t\t\twithoutInteractiveFormatting\n\t\t\t\t\t\t\tonChange={ ( text ) =>\n\t\t\t\t\t\t\t\tsetAttributes( { name: text } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thref={ url }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"wp-element-button bp-attachments-button\">{ __( 'Download', 'bp-attachments') }</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Fragment>\n\t)\n};\n\nexport default editFile;\n","/**\n * WordPress dependencies.\n */\nconst {\n\tblocks: {\n\t\tregisterBlockType,\n\t},\n\telement: {\n\t\tcreateElement,\n\t},\n} = wp;\n\n/**\n * Internal dependencies.\n */\nimport metadata from '../block.json';\nimport editFile from './edit';\n\nregisterBlockType( metadata, {\n\ticon: {\n\t\tbackground: '#fff',\n\t\tforeground: '#d84800',\n\t\tsrc: 'media-text',\n\t},\n\tedit: editFile,\n} );\n"],"names":["module","JSON","parse","apiFetch","components","DropZone","FormFileUpload","Notice","Placeholder","data","useSelect","element","createElement","useState","i18n","__","wp","$caf7cfe3bd8cad6b$export$2e2bcd8739ae039","_ref","type","icon","label","onSetAttributes","bpAttachments","allowedExtByMediaList","allowedExtTypes","mimeTypeImageBaseUrl","select","getEditorSettings","extList","album","allowedTypes","errorMessage","setErrorMessage","userId","postId","getCurrentUser","id","getCurrentPostId","uploadMedia","files","media","currentTarget","file","formData","FormData","append","path","method","body","then","response","links","src","url","view","name","title","mediaType","replace","catch","error","message","$caf7cfe3bd8cad6b$var$createElement","$caf7cfe3bd8cad6b$var$Notice","status","isDismissible","onUploadedMedium","$caf7cfe3bd8cad6b$var$Placeholder","isColumnLayout","className","$caf7cfe3bd8cad6b$var$DropZone","onFilesDrop","$caf7cfe3bd8cad6b$var$FormFileUpload","onChange","multiple","accept","blockEditor","BlockAlignmentControl","BlockControls","useBlockProps","RichText","Fragment","$e47632060b54212d$export$2e2bcd8739ae039","attributes","setAttributes","align","blockProps","undefined","$e47632060b54212d$var$createElement","$e47632060b54212d$var$Fragment","$e47632060b54212d$var$BlockControls","group","$e47632060b54212d$var$BlockAlignmentControl","controls","value","alignment","$e47632060b54212d$var$RichText","tagName","placeholder","withoutInteractiveFormatting","text","href","blocks","registerBlockType","metadata","background","foreground","edit","editFile"],"version":3,"file":"index.js.map"}