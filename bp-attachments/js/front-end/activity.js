!function(){const{template:t}=lodash;const{i18n:{__:e}}=wp,{filter:n}=lodash;var i=t=>{const n=[e("Bytes","bp-attachments"),e("KB","bp-attachments"),e("MB","bp-attachments"),e("GB","bp-attachments"),e("TB","bp-attachments")];if(0===t)return"0 "+n[0];const i=parseInt(Math.floor(Math.log(t)/Math.log(1024)),10);return 0===i?`${t} ${n[i]}`:`${(t/1024**i).toFixed(1)} ${n[i]}`};const{domReady:a}=wp;window.bp=window.bp||{},window.bp.Attachments=window.bp.Attachments||{};const s=window.bpAttachmentsActivitySettings||{};window.bp.Attachments.Activity=new class{renderItemPreview(e){var n;return(n="bp-media-preview",t(document.querySelector("#tmpl-"+n).innerHTML,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"}))(e)}getFileInput(){let t;if(document.querySelector("#bp-attachments-activity-medium"))t=document.querySelector("#bp-attachments-activity-medium");else{t=document.createElement("input"),t.type="file",t.id="bp-attachments-activity-medium",t.name="_bp_attachments_activity_medium",t.style="display: none;",t.accept=this.allowedTypes,this.container.append(t);const e=document.createElement("div");e.id="bp-attachments-activity-medium-preview",this.container.append(e)}return t}upload(t,e){const{model:{attributes:{user_id:n}}}=t;e.addEventListener("change",(t=>{const e=t.target.files[0];if(e){const t=new FormData;t.append("file",e),t.append("action","bp_attachments_media_upload"),t.append("object","members"),t.append("object_item",n),t.append("visibility","public"),t.append("total_bytes",e.size),fetch(this.endpoint,{method:"POST",body:t,headers:{"X-WP-Nonce":this.nonce}}).then((t=>t.json())).then((t=>{t.size&&(t.size=i(t.size)),document.querySelector("#bp-attachments-activity-medium-preview").innerHTML=this.renderItemPreview(t)})).catch((t=>{console.log(t)}))}})),e.click()}start(){const t=this.getFileInput();this.ActivityButtons.on("display:bpAttachments",(e=>this.upload(e,t)))}constructor({path:t,root:e,nonce:n,allowedExtTypes:i}){const{bp:{Nouveau:{Activity:{postForm:{buttons:a}}}}}=window;this.ActivityButtons=a,this.container=document.querySelector("#whats-new-textarea"),this.endpoint=e+t,this.nonce=n,this.allowedTypes=i}}(s),a((()=>window.bp.Attachments.Activity.start()))}();
//# sourceMappingURL=activity.js.map
