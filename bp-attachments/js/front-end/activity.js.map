{"mappings":"YAGA,MAAMA,SACLC,GACGC,GAiHJC,OAAOC,GAAKD,OAAOC,IAAM,GACzBD,OAAOC,GAAGC,YAAcF,OAAOC,GAAGC,aAAe,GAEjD,MAAMC,EAAWH,OAAOI,+BAAiC,GACzDJ,OAAOC,GAAGC,YAAYG,SAAW,IAnHjC,MA0BCC,eACC,IAAIC,EAgBJ,OAdQC,SAASC,cAAe,iCAC/BF,EAAYC,SAASC,cAAe,kCAEpCF,EAAYC,SAASE,cAAe,SACpCH,EAAUI,KAAO,OACjBJ,EAAUK,GAAK,+BACfL,EAAUM,KAAO,gCACjBN,EAAUO,MAAQ,iBAClBP,EAAUQ,OAASC,KAAKC,aAGxBD,KAAKE,UAAUC,OAAQZ,IAGjBA,C,CAWRa,OAAQC,EAAed,GACtB,MACCe,OACCC,YAAYC,QACXA,KAGCH,EAEJd,EAAUkB,iBAAkB,UAAYC,IACvC,MAAMC,EAASD,EAAME,OAAOC,MAAM,GAElC,GAAQF,EAAS,CAChB,MAAMG,EAAW,IAAIC,SACrBD,EAASX,OAAQ,OAAQQ,GACzBG,EAASX,OAAQ,SAAU,+BAC3BW,EAASX,OAAQ,SAAU,WAC3BW,EAASX,OAAQ,cAAeK,GAChCM,EAASX,OAAQ,aAAc,UAC/BW,EAASX,OAAQ,cAAeQ,EAAOK,MAEvCC,MAAOjB,KAAKkB,SAAU,CACrBC,OAAQ,OACRC,KAAMN,EACNO,QAAS,CACR,aAAerB,KAAKsB,SAElBC,MACDC,GAAcA,EAASC,SACxBF,MACCG,IACDC,QAAQC,IAAKF,EAAM,IAEnBG,OAASC,IACVH,QAAQC,IAAKE,EAAO,G,KAKvBvC,EAAUwC,O,CAQVC,QACA,MAAMzC,EAAYS,KAAKV,eAEvBU,KAAKiC,gBAAgBC,GACpB,yBACE7B,GAAmBL,KAAKI,OAAQC,EAAed,I,CApGnD4C,aAAaC,KAAEA,EAAIC,KAAEA,EAAIf,MAAEA,EAAKgB,gBAAEA,IACjC,MACCrD,IACCsD,SACClD,UACCmD,UAAUC,QACTA,OAKDzD,OAEJgB,KAAKiC,gBAAkBQ,EACvBzC,KAAKE,UAAYV,SAASC,cAAe,uBACzCO,KAAKkB,SAAWmB,EAAOD,EACvBpC,KAAKsB,MAAQA,EACbtB,KAAKC,aAAeqC,C,GA4FsCnD,GAE5DL,GAAU,IAAME,OAAOC,GAAGC,YAAYG,SAAS2C,S","sources":["src/front-end/activity.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nconst {\n\tdomReady,\n} = wp;\n\nclass bpAttachmentsActivity {\n\t/**\n\t * Setup the Activity Buttons.\n\t *\n\t * @since 1.0.0\n\t */\n\tconstructor( { path, root, nonce, allowedExtTypes } ) {\n\t\tconst {\n\t\t\tbp: {\n\t\t\t\tNouveau: {\n\t\t\t\t\tActivity: {\n\t\t\t\t\t\tpostForm: {\n\t\t\t\t\t\t\tbuttons,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} = window;\n\n\t\tthis.ActivityButtons = buttons;\n\t\tthis.container = document.querySelector( '#whats-new-textarea' );\n\t\tthis.endpoint = root + path;\n\t\tthis.nonce = nonce;\n\t\tthis.allowedTypes = allowedExtTypes;\n\t}\n\n\tgetFileInput() {\n\t\tlet fileInput;\n\n\t\tif ( !! document.querySelector( '#bp-attachments-activity-file' ) ) {\n\t\t\tfileInput = document.querySelector( '#bp-attachments-activity-file' );\n\t\t} else {\n\t\t\tfileInput = document.createElement( 'input' );\n\t\t\tfileInput.type = 'file';\n\t\t\tfileInput.id = 'bp-attachments-activity-file';\n\t\t\tfileInput.name = '_bp_attachments_activity_file';\n\t\t\tfileInput.style = 'display: none;';\n\t\t\tfileInput.accept = this.allowedTypes;\n\n\t\t\t// Add it to the DOM.\n\t\t\tthis.container.append( fileInput );\n\t\t}\n\n\t\treturn fileInput;\n\t}\n\n\t/**\n\t * Open the file browser and process the upload.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} backboneEvent\n\t * @param {HTMLInputElement} fileInput\n\t */\n\tupload( backboneEvent, fileInput ) {\n\t\tconst {\n\t\t\tmodel: {\n\t\t\t\tattributes: {\n\t\t\t\t\tuser_id,\n\t\t\t\t}\n\t\t\t}\n\t\t} = backboneEvent;\n\n\t\tfileInput.addEventListener( 'change', ( event ) => {\n\t\t\tconst medium = event.target.files[0];\n\n\t\t\tif ( !! medium ) {\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.append( 'file', medium );\n\t\t\t\tformData.append( 'action', 'bp_attachments_media_upload' );\n\t\t\t\tformData.append( 'object', 'members' );\n\t\t\t\tformData.append( 'object_item', user_id );\n\t\t\t\tformData.append( 'visibility', 'public' );\n\t\t\t\tformData.append( 'total_bytes', medium.size );\n\n\t\t\t\tfetch( this.endpoint, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: formData,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'X-WP-Nonce' : this.nonce,\n\t\t\t\t\t}\n\t\t\t\t} ).then(\n\t\t\t\t\t( response ) => response.json()\n\t\t\t\t).then(\n\t\t\t\t\t( data ) => {\n\t\t\t\t\t\tconsole.log( data );\n\t\t\t\t\t}\n\t\t\t\t).catch( ( error ) => {\n\t\t\t\t\tconsole.log( error );\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\tfileInput.click();\n\t}\n\n\t/**\n\t * Init the Activity Attachments Button.\n\t *\n\t * @since 1.0.0\n\t */\n\t start() {\n\t\tconst fileInput = this.getFileInput();\n\n\t\tthis.ActivityButtons.on(\n\t\t\t'display:bpAttachments',\n\t\t\t( backboneEvent ) => this.upload( backboneEvent, fileInput )\n\t\t);\n\t }\n}\n\nwindow.bp = window.bp || {};\nwindow.bp.Attachments = window.bp.Attachments || {};\n\nconst settings = window.bpAttachmentsActivitySettings || {};\nwindow.bp.Attachments.Activity = new bpAttachmentsActivity( settings );\n\ndomReady( () => window.bp.Attachments.Activity.start() );\n"],"names":["domReady","$9d5136835f9d0051$var$domReady","wp","window","bp","Attachments","$9d5136835f9d0051$var$settings","bpAttachmentsActivitySettings","Activity","getFileInput","fileInput","document","querySelector","createElement","type","id","name","style","accept","this","allowedTypes","container","append","upload","backboneEvent","model","attributes","user_id","addEventListener","event","medium","target","files","formData","FormData","size","fetch","endpoint","method","body","headers","nonce","then","response","json","data","console","log","catch","error","click","start","ActivityButtons","on","constructor","path","root","allowedExtTypes","Nouveau","postForm","buttons"],"version":3,"file":"activity.js.map"}