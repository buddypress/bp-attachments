{"mappings":"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","sources":["src/media-library/utils/set-template.js","src/media-library/utils/functions.js","src/front-end/activity.js"],"sourcesContent":["/**\n * External dependencies\n */\nconst { template } = lodash;\n\nfunction setTemplate( tmpl ) {\n\tconst options = {\n\t\tevaluate:    /<#([\\s\\S]+?)#>/g,\n\t\tinterpolate: /\\{\\{\\{([\\s\\S]+?)\\}\\}\\}/g,\n\t\tescape:      /\\{\\{([^\\}]+?)\\}\\}(?!\\})/g,\n\t\tvariable:    'data'\n\t};\n\n\treturn template( document.querySelector( '#tmpl-' + tmpl ).innerHTML, options );\n}\n\nexport default setTemplate;\n","/**\n * WordPress dependencies\n */\nconst {\n\ti18n: {\n\t\t__,\n\t},\n} = wp;\n\n/**\n * External dependencies\n */\nconst { filter } = lodash;\n\nexport const getDirectoryAncestors = ( tree, parentId ) => {\n\tlet parents = filter( tree, { id: parentId } );\n\n\tparents.forEach( ( parent ) => {\n\t\tconst grandParents = getDirectoryAncestors( tree, parent.parent );\n\t\tparents = [ ...parents, ...grandParents ];\n\t} );\n\n\treturn parents;\n}\n\nexport const bytesToSize = ( bytes ) => {\n\tconst sizes = [\n\t\t__( 'Bytes', 'bp-attachments' ),\n\t\t__( 'KB', 'bp-attachments' ),\n\t\t__( 'MB', 'bp-attachments' ),\n\t\t__( 'GB', 'bp-attachments' ),\n\t\t__( 'TB', 'bp-attachments' ),\n\t];\n\n\tif ( bytes === 0 ) {\n\t\treturn '0 ' + sizes[0];\n\t}\n\n\tconst i = parseInt( Math.floor( Math.log( bytes ) / Math.log( 1024 ) ), 10 );\n\n\tif ( i === 0 ) {\n\t\treturn `${bytes} ${sizes[i]}`;\n\t}\n\n\treturn `${ ( bytes / ( 1024 ** i ) ).toFixed( 1 ) } ${ sizes[ i ] }`;\n}\n\nexport default bytesToSize;\n","/**\n * WordPress dependencies\n */\nconst {\n\tdomReady,\n} = wp;\n\n/**\n * Internal dependencies.\n */\nimport setTemplate from '../media-library/utils/set-template';\nimport bytesToSize from '../media-library/utils/functions';\n\nclass bpAttachmentsActivity {\n\t/**\n\t * Setup the Activity Buttons.\n\t *\n\t * @since 1.0.0\n\t */\n\tconstructor( { path, root, nonce, allowedExtTypes } ) {\n\t\tconst {\n\t\t\tbp: {\n\t\t\t\tNouveau: {\n\t\t\t\t\tActivity: {\n\t\t\t\t\t\tpostForm: {\n\t\t\t\t\t\t\tbuttons,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} = window;\n\n\t\tthis.ActivityButtons = buttons;\n\t\tthis.container = document.querySelector( '#whats-new-textarea' );\n\t\tthis.endpoint = root + path;\n\t\tthis.nonce = nonce;\n\t\tthis.allowedTypes = allowedExtTypes;\n\t\tthis.uploadedFiles = [];\n\t}\n\n\t/**\n\t * Renders the Medium preview.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} props The medium properties.\n\t * @returns {string} HTML output.\n\t */\n\t renderItemPreview( props ) {\n\t\tconst Template = setTemplate( 'bp-media-preview' );\n\t\treturn Template( props );\n\t}\n\n\t/**\n\t * Open the file browser and process the upload.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} backboneEvent\n\t */\n\tupload( backboneEvent ) {\n\t\tconst {\n\t\t\tcollection: {\n\t\t\t\tmodels,\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\tattributes: {\n\t\t\t\t\tuser_id,\n\t\t\t\t}\n\t\t\t},\n\t\t} = backboneEvent;\n\t\tconst fileInput = document.createElement( 'input' );\n\t\tfileInput.type = 'file';\n\t\tfileInput.id = 'bp-attachments-activity-medium';\n\t\tfileInput.name = '_bp_attachments_activity_medium';\n\t\tfileInput.style = 'display: none;';\n\t\tfileInput.accept = this.allowedTypes;\n\n\t\t// Add the File input to the DOM & simulate a click.\n\t\tif ( ! this.container.querySelector( '#bp-attachments-activity-medium' ) ) {\n\t\t\tthis.container.append( fileInput );\n\t\t\tfileInput.click();\n\t\t}\n\n\t\tfileInput.addEventListener( 'change', ( event ) => {\n\t\t\tevent.preventDefault();\n\n\t\t\tconst medium = event.target.files[0];\n\n\t\t\t// Make sure to only upload once a file.\n\t\t\tif ( !! medium && -1 === this.uploadedFiles.indexOf( medium.name ) ) {\n\t\t\t\tthis.uploadedFiles.push( medium.name );\n\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.append( 'file', medium );\n\t\t\t\tformData.append( 'action', 'bp_attachments_media_upload' );\n\t\t\t\tformData.append( 'object', 'members' );\n\t\t\t\tformData.append( 'object_item', user_id );\n\t\t\t\tformData.append( 'visibility', 'public' );\n\t\t\t\tformData.append( 'total_bytes', medium.size );\n\n\t\t\t\tconst previousErrors = backboneEvent.model.get( 'errors' );\n\t\t\t\tif ( previousErrors && previousErrors.origin && 'bpAttachments' === previousErrors.origin ) {\n\t\t\t\t\tbackboneEvent.model.unset( 'errors' );\n\t\t\t\t}\n\n\t\t\t\tfetch( this.endpoint, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tbody: formData,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'X-WP-Nonce' : this.nonce,\n\t\t\t\t\t}\n\t\t\t\t} ).then(\n\t\t\t\t\t( response ) => response.json()\n\t\t\t\t).then(\n\t\t\t\t\t( data ) => {\n\t\t\t\t\t\tif ( data.code && data.message ) {\n\t\t\t\t\t\t\tbackboneEvent.model.set( 'errors', { type: 'error', value: data.message, origin: 'bpAttachments' } );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( data.size ) {\n\t\t\t\t\t\t\tdata.size = bytesToSize( data.size );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Render the media preview.\n\t\t\t\t\t\tdocument.querySelector( '#bp-attachments-activity-medium-preview' ).innerHTML = this.renderItemPreview( data );\n\t\t\t\t\t}\n\t\t\t\t).finally( () => {\n\t\t\t\t\tthis.container.querySelector( '#bp-attachments-activity-medium' ).remove();\n\n\t\t\t\t\tmodels.forEach( ( buttonModel ) => {\n\t\t\t\t\t\tif ( 'bpAttachments' === buttonModel.get( 'id' ) ) {\n\t\t\t\t\t\t\tbuttonModel.set( 'active', false );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Remove all Medium preview content.\n\t *\n\t * @since 1.0.0\n\t */\n\treset() {\n\t\tdocument.querySelector( '#bp-attachments-activity-medium-preview' ).innerHTML = '';\n\t}\n\n\t/**\n\t * Init the Activity Attachments Button.\n\t *\n\t * @since 1.0.0\n\t */\n\t start() {\n\t\t// Add the preview placeholder.\n\t\tconst previewPlaceholder = document.createElement( 'div' );\n\t\tpreviewPlaceholder.id = 'bp-attachments-activity-medium-preview';\n\n\t\t// Add the placeholder to the DOM.\n\t\tthis.container.append( previewPlaceholder );\n\n\t\tthis.ActivityButtons.on(\n\t\t\t'display:bpAttachments',\n\t\t\t( backboneEvent ) => this.upload( backboneEvent )\n\t\t);\n\n\t\tthis.ActivityButtons.on(\n\t\t\t'resetForm:bpAttachments',\n\t\t\t() => this.reset()\n\t\t);\n\n\t\tthis.container.addEventListener(\n\t\t\t'click',\n\t\t\t( event ) => {\n\t\t\t\tif ( 'bp-attachments-medium-preview-exit' === event.target.getAttribute( 'id' ) ) {\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\treturn this.reset();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tdocument.querySelector( '#whats-new' ).addEventListener(\n\t\t\t'focus',\n\t\t\t() => {\n\t\t\t\tdocument.querySelectorAll( '[data-button=\"bpAttachments\"]' ).forEach( ( btn ) => {\n\t\t\t\t\tif ( ! btn.classList.contains( 'bp-tooltip' ) ) {\n\t\t\t\t\t\tbtn.classList.add( 'bp-tooltip' );\n\t\t\t\t\t\tbtn.setAttribute( 'data-bp-tooltip', btn.querySelector( '.bp-screen-reader-text' ).innerHTML );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t);\n\t }\n}\n\nwindow.bp = window.bp || {};\nwindow.bp.Attachments = window.bp.Attachments || {};\n\nconst settings = window.bpAttachmentsActivitySettings || {};\nwindow.bp.Attachments.Activity = new bpAttachmentsActivity( settings );\n\ndomReady( () => window.bp.Attachments.Activity.start() );\n"],"names":["template","lodash","i18n","__","wp","filter","$be1cf92520ac449f$export$2e2bcd8739ae039","bytes","sizes","i","parseInt","Math","floor","log","toFixed","domReady","$9d5136835f9d0051$var$domReady","window","bp","Attachments","$9d5136835f9d0051$var$settings","bpAttachmentsActivitySettings","Activity","renderItemPreview","props","tmpl","document","querySelector","innerHTML","evaluate","interpolate","escape","variable","upload","backboneEvent","collection","models","model","attributes","user_id","fileInput","createElement","type","id","name","style","accept","this","allowedTypes","container","append","click","addEventListener","event","preventDefault","medium","target","files","uploadedFiles","indexOf","push","formData","FormData","size","previousErrors","get","origin","unset","fetch","endpoint","method","body","headers","nonce","then","response","json","data","code","message","set","value","finally","remove","forEach","buttonModel","reset","start","previewPlaceholder","ActivityButtons","on","getAttribute","querySelectorAll","btn","classList","contains","add","setAttribute","constructor","path","root","allowedExtTypes","Nouveau","postForm","buttons"],"version":3,"file":"activity.js.map"}