!function(){const{template:t}=lodash;const{domReady:e,url:{addQueryArgs:s,getPath:i,getQueryArgs:a}}=wp;window.bp=window.bp||{},window.bp.Attachments=window.bp.Attachments||{};const n=window.bpAttachmentsDirectorySettings||{};window.bp.Attachments.Directory=new class{renderItem(e){e._embedded&&e._embedded.owner&&(e.owner=e._embedded.owner.at(0));var s;return(s=this.template,t(document.querySelector("#tmpl-"+s).innerHTML,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"}))(e)}renderItems(t){t.forEach((t=>{this.container.innerHTML+=this.renderItem(t)})),document.querySelectorAll(".bp-media-item").forEach((t=>{t.innerHTML.trim()?t.style.height=t.clientWidth+"px":t.style.display="none"}))}query(){this.isFetching=!0;const t=parseInt(this.queryArgs.page,10),e={...this.queryArgs};1===e.page&&delete e.page,setTimeout((()=>{fetch(s(this.root+this.endpoint,e),{method:"GET",headers:{"X-WP-Nonce":this.nonce}}).then((t=>200!==t.status?[]:(this.totalItems=parseInt(t.headers.get("X-WP-Total"),10),this.totalPages=parseInt(t.headers.get("X-WP-TotalPages"),10),t.json()))).then((e=>{this.items=1===t?e:[...this.items,e],this.renderItems(e),this.isFetching=!1})).catch((()=>{this.items=[],this.totalItems=0,this.totalPages=1}))}),500)}setupListeners(){document.addEventListener("click",(t=>{const e=t.target.closest("li[data-bp-scope]");null!==e&&this.scope!==e.dataset.bpScope&&(t.preventDefault(),this.scope=e.dataset.bpScope,this.queryArgs.type=e.dataset.bpScope,this.container.innerHTML="",e.closest(".component-navigation").childNodes.forEach((t=>{t.classList&&(e.dataset.bpScope===t.dataset.bpScope?t.classList.add("selected"):t.classList.remove("selected"))})),this.queryArgs.page=1,this.query())}))}start(){this.setupListeners(),this.items&&this.items.length&&this.renderItems(this.items)}constructor({path:t,root:e,nonce:s,items:n}){const{body:r}=n;this.items=r,this.queryArgs={...a(t),page:1,per_page:20},this.endpoint=i(e.replace("/wp-json","")+t),this.root=e,this.nonce=s,this.scope="any",this.isFetching=!1,this.totalItems=0,this.totalPages=0,this.template="bp-media-item",this.container=document.querySelector("#bp-media-directory"),"headers"in n&&Object.keys(n.headers).forEach((t=>{"X-WP-Total"===t?this.totalItems=parseInt(n.headers[t],10):"X-WP-TotalPages"===t&&(this.totalPages=parseInt(n.headers[t],10))}))}}(n),e((()=>window.bp.Attachments.Directory.start()))}();
//# sourceMappingURL=directory.js.map
