!function(){const{template:e}=lodash;const{domReady:t,url:{addQueryArgs:s,getPath:i,getQueryArgs:r}}=wp;window.bp=window.bp||{},window.bp.Attachments=window.bp.Attachments||{};const a=window.bpAttachmentsDirectorySettings||{};window.bp.Attachments.Directory=new class{renderItem(t,s){t._embedded&&t._embedded.owner&&(t.owner=t._embedded.owner.at(0)),s||(s=this.template);var i;return(i=s,e(document.querySelector("#tmpl-"+i).innerHTML,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"}))(t)}renderItems(e){e.forEach((e=>{this.container.innerHTML+=this.renderItem(e)})),document.querySelectorAll(".bp-media-item").forEach((e=>{e.innerHTML.trim()?e.style.height=e.clientWidth+"px":e.style.display="none"})),this.loadMore()}doSkeletonLoading(){const e={id:0,placeholder:this.filePlaceholder};let t=parseInt(this.queryArgs.per_page,10);const s=t,i=parseInt(this.queryArgs.page,10);if(1===this.queryArgs.page)this.container.innerHTML="";else{i*s>this.totalItems&&(t=this.totalItems-this.items.length)}for(let s=0;s<t;s++)this.container.innerHTML+=this.renderItem(e,"bp-media-skeleton")}loadMore(){let e=document.querySelector(".bp-attachments-media-list > div:not(.bp-skeleton):last-child");new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&!this.isFetching&&parseInt(this.queryArgs.page,10)<this.totalPages&&(this.queryArgs.page+=1,this.query())}))}),{root:null,rootMargin:"0px",threshold:1}).observe(e)}query(){this.doSkeletonLoading(),this.isFetching=!0;const e=parseInt(this.queryArgs.page,10),t={...this.queryArgs};1===t.page&&delete t.page,setTimeout((()=>{fetch(s(this.root+this.endpoint,t),{method:"GET",headers:{"X-WP-Nonce":this.nonce}}).then((e=>200!==e.status?[]:(this.totalItems=parseInt(e.headers.get("X-WP-Total"),10),this.totalPages=parseInt(e.headers.get("X-WP-TotalPages"),10),e.json()))).then((t=>{this.items=1===e?t:[...this.items,t],this.renderItems(t),this.isFetching=!1})).catch((()=>{this.items=[],this.totalItems=0,this.totalPages=1})).finally((()=>{this.container.querySelectorAll(".bp-media-item.skeleton").forEach((e=>e.remove()))}))}),500)}setupListeners(){document.addEventListener("click",(e=>{const t=e.target.closest("li[data-bp-scope]");null!==t&&this.scope!==t.dataset.bpScope&&(e.preventDefault(),this.scope=t.dataset.bpScope,this.queryArgs.type=t.dataset.bpScope,t.closest(".component-navigation").childNodes.forEach((e=>{e.classList&&(t.dataset.bpScope===e.dataset.bpScope?e.classList.add("selected"):e.classList.remove("selected"))})),this.queryArgs.page=1,this.query())}))}start(){this.setupListeners(),this.items&&this.items.length&&(this.container.querySelector("#bp-attachments-no-media").remove(),this.renderItems(this.items))}constructor({path:e,root:t,nonce:s,placeholder:a,items:o}){const{body:n}=o;this.items=n,this.queryArgs={...r(e),page:1,per_page:20},this.endpoint=i(t.replace("/wp-json","")+e),this.root=t,this.nonce=s,this.scope="any",this.isFetching=!1,this.totalItems=0,this.totalPages=0,this.template="bp-media-item",this.filePlaceholder=a,this.container=document.querySelector("#bp-media-directory"),"headers"in o&&Object.keys(o.headers).forEach((e=>{"X-WP-Total"===e?this.totalItems=parseInt(o.headers[e],10):"X-WP-TotalPages"===e&&(this.totalPages=parseInt(o.headers[e],10))}))}}(a),t((()=>window.bp.Attachments.Directory.start()))}();
//# sourceMappingURL=directory.js.map
