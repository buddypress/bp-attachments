!function(){const{template:e}=lodash;var t=function(e,t,s,i){return new Promise((a=>{const r=new Image;r.onload=()=>{const e=r.naturalWidth,n=r.naturalHeight,o=e/n;if(r.naturalHeight<=i||r.naturalWidth<=s)a({src:r.src,className:r.naturalHeight<=i?"bp-full-width":"bp-full-height"});else{let s=e,i=n;o>t?s=n*t:o<t&&(i=e/t);const h=.5*(s-e),c=.5*(i-n),l=document.createElement("canvas");l.width=s,l.height=i;l.getContext("2d").drawImage(r,h,c),a({src:l.toDataURL("image/png"),className:"bp-cropped-image"})}},r.src=e}))};const{domReady:s,url:{addQueryArgs:i,getPath:a,getQueryArgs:r}}=wp;window.bp=window.bp||{},window.bp.Attachments=window.bp.Attachments||{};const n=window.bpAttachmentsDirectorySettings||{};window.bp.Attachments.Directory=new class{renderItem(t,s){t._embedded&&t._embedded.owner&&(t.owner=t._embedded.owner.at(0)),s||(s=this.template);var i;return(i=s,e(document.querySelector("#tmpl-"+i).innerHTML,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"}))(t)}renderItems(e){e.length||"any"===this.queryArgs.type?(e.forEach((e=>{this.container.innerHTML+=this.renderItem(e)})),document.querySelectorAll(".bp-media-item").forEach((e=>{if(e.innerHTML.trim()){const s=e.clientWidth,i=s,a=e.querySelector(".wp-block-bp-image-attachment img");a&&a.src&&t(a.src,1,s,i).then((e=>{a.src=e.src,a.classList.add(e.className),"bp-full-height"===e.className&&(a.style.maxHeight=i+"px")})),e.style.height=s+"px"}else e.style.display="none"})),this.loadMore()):this.container.innerHTML=this.renderItem({},"bp-media-empty-results")}doSkeletonLoading(){const e={id:0,placeholder:this.filePlaceholder};let t=parseInt(this.queryArgs.per_page,10);const s=t,i=parseInt(this.queryArgs.page,10);if(1===this.queryArgs.page)this.container.innerHTML="";else{i*s>this.totalItems&&(t=this.totalItems-this.items.length)}for(let s=0;s<t;s++)this.container.innerHTML+=this.renderItem(e,"bp-media-skeleton")}loadMore(){let e=document.querySelector(".bp-attachments-media-list > div:not(.bp-skeleton):last-child");new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&!this.isFetching&&parseInt(this.queryArgs.page,10)<this.totalPages&&(this.queryArgs.page+=1,this.query())}))}),{root:null,rootMargin:"0px",threshold:1}).observe(e)}query(){this.doSkeletonLoading(),this.isFetching=!0;const e=parseInt(this.queryArgs.page,10),t={...this.queryArgs};1===t.page&&delete t.page,setTimeout((()=>{fetch(i(this.root+this.endpoint,t),{method:"GET",headers:{"X-WP-Nonce":this.nonce}}).then((e=>200!==e.status?[]:(this.totalItems=parseInt(e.headers.get("X-WP-Total"),10),this.totalPages=parseInt(e.headers.get("X-WP-TotalPages"),10),e.json()))).then((t=>{this.items=1===e?t:[...this.items,t],this.renderItems(t),this.isFetching=!1})).catch((()=>{this.items=[],this.totalItems=0,this.totalPages=1})).finally((()=>{this.container.querySelectorAll(".bp-media-item.skeleton").forEach((e=>e.remove()))}))}),500)}setupListeners(){document.addEventListener("click",(e=>{const t=e.target.closest("li[data-bp-scope]");null!==t&&this.scope!==t.dataset.bpScope&&(e.preventDefault(),this.scope=t.dataset.bpScope,this.queryArgs.type=t.dataset.bpScope,t.closest(".component-navigation").childNodes.forEach((e=>{e.classList&&(t.dataset.bpScope===e.dataset.bpScope?e.classList.add("selected"):e.classList.remove("selected"))})),this.queryArgs.page=1,this.query())}))}start(){this.setupListeners(),this.items&&this.items.length&&(this.container.querySelector("#bp-attachments-no-media").remove(),this.renderItems(this.items))}constructor({path:e,root:t,nonce:s,placeholder:i,items:n}){const{body:o}=n;this.items=o,this.queryArgs={...r(e),page:1,per_page:20},this.endpoint=a(t.replace("/wp-json","")+e),this.root=t,this.nonce=s,this.scope="any",this.isFetching=!1,this.totalItems=0,this.totalPages=0,this.template="bp-media-item",this.filePlaceholder=i,this.container=document.querySelector("#bp-media-directory"),"headers"in n&&Object.keys(n.headers).forEach((e=>{"X-WP-Total"===e?this.totalItems=parseInt(n.headers[e],10):"X-WP-TotalPages"===e&&(this.totalPages=parseInt(n.headers[e],10))}))}}(n),s((()=>window.bp.Attachments.Directory.start()))}();
//# sourceMappingURL=directory.js.map
