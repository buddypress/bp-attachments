{"mappings":"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","sources":["src/media-library/utils/set-template.js","src/front-end/directory.js"],"sourcesContent":["/**\n * External dependencies\n */\nconst { template } = lodash;\n\nfunction setTemplate( tmpl ) {\n\tconst options = {\n\t\tevaluate:    /<#([\\s\\S]+?)#>/g,\n\t\tinterpolate: /\\{\\{\\{([\\s\\S]+?)\\}\\}\\}/g,\n\t\tescape:      /\\{\\{([^\\}]+?)\\}\\}(?!\\})/g,\n\t\tvariable:    'data'\n\t};\n\n\treturn template( document.querySelector( '#tmpl-' + tmpl ).innerHTML, options );\n}\n\nexport default setTemplate;\n","/**\n * WordPress dependencies\n */\nconst {\n\tdomReady,\n\turl: {\n\t\taddQueryArgs,\n\t\tgetPath,\n\t\tgetQueryArgs,\n\t},\n} = wp;\n\n/**\n * Internal dependencies.\n */\nimport setTemplate from '../media-library/utils/set-template';\n\nclass bpAttachmentsDirectory {\n\t/**\n\t * Setup the Directory.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} preloadedData The preloaded data.\n\t */\n\tconstructor( { path, root, nonce, items } ) {\n\t\tconst { body } = items;\n\t\tthis.items = body;\n\t\tthis.queryArgs = { ...getQueryArgs( path ), page: 1, per_page: 20 };\n\t\tthis.endpoint = getPath( root.replace( '/wp-json', '' ) + path );\n\t\tthis.root = root;\n\t\tthis.nonce = nonce;\n\t\tthis.scope = 'any';\n\t\tthis.isFetching = false;\n\t\tthis.totalItems = 0;\n\t\tthis.totalPages = 0;\n\t\tthis.template = 'bp-media-item';\n\t\tthis.container = document.querySelector( '#bp-media-directory' );\n\n\t\tif ( 'headers' in items ) {\n\t\t\tObject.keys( items.headers ).forEach( ( header ) => {\n\t\t\t\tif ( 'X-WP-Total' === header ) {\n\t\t\t\t\tthis.totalItems = parseInt( items.headers[ header ], 10 );\n\t\t\t\t} else if ( 'X-WP-TotalPages' === header ) {\n\t\t\t\t\tthis.totalPages = parseInt( items.headers[ header ], 10 );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * Renders the HTML of a medium.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} props The medium properties.\n\t * @returns {string} HTML output.\n\t */\n\trenderItem( props ) {\n\t\tif ( props._embedded && props._embedded.owner ) {\n\t\t\tprops.owner = props._embedded.owner.at( 0 );\n\t\t}\n\n\t\tconst Template = setTemplate( this.template );\n\t\treturn Template( props );\n\t}\n\n\t/**\n\t * Renders Media.\n\t *\n\t * @since 1.0.0\n\t */\n\trenderItems( items ) {\n\t\titems.forEach( ( item ) => {\n\t\t\tthis.container.innerHTML += this.renderItem( item );\n\t\t} );\n\n\t\tdocument.querySelectorAll( '.bp-media-item' ).forEach( ( renderedItem ) => {\n\t\t\t// Only show existing media.\n\t\t\tif ( !! renderedItem.innerHTML.trim() ) {\n\t\t\t\trenderedItem.style.height = renderedItem.clientWidth + 'px';\n\t\t\t} else {\n\t\t\t\trenderedItem.style.display = 'none';\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Fetch community media according to query arguments.\n\t *\n\t * @since 1.0.0\n\t */\n\tquery() {\n\t\t// Prevent multiple fetching.\n\t\tthis.isFetching = true;\n\t\tconst currentPage = parseInt( this.queryArgs.page, 10 );\n\t\tconst queryArgs = { ...this.queryArgs };\n\n\t\tif ( 1 === queryArgs.page ) {\n\t\t\tdelete queryArgs.page;\n\t\t}\n\n\t\tsetTimeout( () => {\n\t\t\tfetch( addQueryArgs( this.root + this.endpoint, queryArgs ), {\n\t\t\t\tmethod: 'GET',\n\t\t\t\theaders: {\n\t\t\t\t\t'X-WP-Nonce' : this.nonce,\n\t\t\t\t}\n\t\t\t} ).then(\n\t\t\t\t( response ) => {\n\t\t\t\t\tif ( 200 !== response.status ) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.totalItems = parseInt( response.headers.get( 'X-WP-Total' ), 10 );\n\t\t\t\t\tthis.totalPages = parseInt( response.headers.get( 'X-WP-TotalPages' ), 10 );\n\n\t\t\t\t\t// Release the JSON data.\n\t\t\t\t\treturn response.json();\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t( data ) => {\n\t\t\t\t\tif ( 1 === currentPage ) {\n\t\t\t\t\t\tthis.items = data;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.items = [ ...this.items, data ];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.renderItems( data );\n\n\t\t\t\t\t// Make fetching available again.\n\t\t\t\t\tthis.isFetching = false;\n\t\t\t\t}\n\t\t\t).catch(\n\t\t\t\t() => {\n\t\t\t\t\t// Update query results.\n\t\t\t\t\tthis.items = [];\n\t\t\t\t\tthis.totalItems = 0;\n\t\t\t\t\tthis.totalPages = 1;\n\t\t\t\t}\n\t\t\t);\n\t\t}, 500 );\n\t}\n\n\t/**\n\t * Add listeners to catch interface changes made by the user.\n\t *\n\t * @since 1.0.0\n\t */\n\tsetupListeners() {\n\t\tdocument.addEventListener( 'click', ( e ) => {\n\t\t\tconst mainNavItem = e.target.closest( 'li[data-bp-scope]' );\n\n\t\t\tif ( null !== mainNavItem && this.scope !== mainNavItem.dataset.bpScope ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tthis.scope = mainNavItem.dataset.bpScope;\n\t\t\t\tthis.queryArgs.type = mainNavItem.dataset.bpScope;\n\t\t\t\tthis.container.innerHTML = '';\n\n\t\t\t\tmainNavItem.closest( '.component-navigation' ).childNodes.forEach( ( child ) => {\n\t\t\t\t\tif ( !! child.classList ) {\n\t\t\t\t\t\tif ( mainNavItem.dataset.bpScope === child.dataset.bpScope ) {\n\t\t\t\t\t\t\tchild.classList.add( 'selected' )\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tchild.classList.remove( 'selected' );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\t// Reset the page argument before querying.\n\t\t\t\tthis.queryArgs.page = 1;\n\t\t\t\tthis.query();\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Init the Directory.\n\t *\n\t * @since 1.0.0\n\t */\n\t start() {\n\t\tthis.setupListeners();\n\n\t\tif ( ! this.items || ! this.items.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderItems( this.items );\n\t }\n}\n\nwindow.bp = window.bp || {};\nwindow.bp.Attachments = window.bp.Attachments || {};\n\nconst directorySettings = window.bpAttachmentsDirectorySettings || {};\nwindow.bp.Attachments.Directory = new bpAttachmentsDirectory( directorySettings );\n\ndomReady( () => window.bp.Attachments.Directory.start() );\n"],"names":["template","lodash","domReady","$89823c8e39abf570$var$domReady","url","addQueryArgs","$89823c8e39abf570$var$addQueryArgs","getPath","$89823c8e39abf570$var$getPath","getQueryArgs","$89823c8e39abf570$var$getQueryArgs","wp","window","bp","Attachments","$89823c8e39abf570$var$directorySettings","bpAttachmentsDirectorySettings","Directory","renderItem","props","_embedded","owner","at","tmpl","this","document","querySelector","innerHTML","evaluate","interpolate","escape","variable","renderItems","items","forEach","item","container","querySelectorAll","renderedItem","trim","style","height","clientWidth","display","query","isFetching","currentPage","parseInt","queryArgs","page","setTimeout","fetch","root","endpoint","method","headers","nonce","then","response","status","totalItems","get","totalPages","json","data","catch","setupListeners","addEventListener","e","mainNavItem","target","closest","scope","dataset","bpScope","preventDefault","type","childNodes","child","classList","add","remove","start","length","constructor","path","body","per_page","replace","Object","keys","header"],"version":3,"file":"directory.js.map"}