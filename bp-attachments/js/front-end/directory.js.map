{"mappings":"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","sources":["src/media-library/utils/set-template.js","src/front-end/directory.js"],"sourcesContent":["/**\n * External dependencies\n */\nconst { template } = lodash;\n\nfunction setTemplate( tmpl ) {\n\tconst options = {\n\t\tevaluate:    /<#([\\s\\S]+?)#>/g,\n\t\tinterpolate: /\\{\\{\\{([\\s\\S]+?)\\}\\}\\}/g,\n\t\tescape:      /\\{\\{([^\\}]+?)\\}\\}(?!\\})/g,\n\t\tvariable:    'data'\n\t};\n\n\treturn template( document.querySelector( '#tmpl-' + tmpl ).innerHTML, options );\n}\n\nexport default setTemplate;\n","/**\n * WordPress dependencies\n */\nconst {\n\tdomReady,\n\turl: {\n\t\taddQueryArgs,\n\t\tgetPath,\n\t\tgetQueryArgs,\n\t},\n} = wp;\n\n/**\n * Internal dependencies.\n */\nimport setTemplate from '../media-library/utils/set-template';\n\nclass bpAttachmentsDirectory {\n\t/**\n\t * Setup the Directory.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} directorySettings The Attachments directory settings.\n\t * @param {string} directorySettings.path The BP REST API path.\n\t * @param {string} directorySettings.root The REST API root path.\n\t * @param {string} directorySettings.nonce The REST API nonce value.\n\t * @param {string} directorySettings.placeholder The URL of the WordPress default mime type image.\n\t * @param {Object} directorySettings.items The result of the preloaeded BP PREST API request.\n\t */\n\tconstructor( { path, root, nonce, placeholder, items } ) {\n\t\tconst { body } = items;\n\t\tthis.items = body;\n\t\tthis.queryArgs = { ...getQueryArgs( path ), page: 1, per_page: 20 };\n\t\tthis.endpoint = getPath( root.replace( '/wp-json', '' ) + path );\n\t\tthis.root = root;\n\t\tthis.nonce = nonce;\n\t\tthis.scope = 'any';\n\t\tthis.isFetching = false;\n\t\tthis.totalItems = 0;\n\t\tthis.totalPages = 0;\n\t\tthis.template = 'bp-media-item';\n\t\tthis.filePlaceholder = placeholder;\n\t\tthis.container = document.querySelector( '#bp-media-directory' );\n\n\t\tif ( 'headers' in items ) {\n\t\t\tObject.keys( items.headers ).forEach( ( header ) => {\n\t\t\t\tif ( 'X-WP-Total' === header ) {\n\t\t\t\t\tthis.totalItems = parseInt( items.headers[ header ], 10 );\n\t\t\t\t} else if ( 'X-WP-TotalPages' === header ) {\n\t\t\t\t\tthis.totalPages = parseInt( items.headers[ header ], 10 );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * Renders the HTML of a medium.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} props The medium properties.\n\t * @param {string} template The template to use.\n\t * @returns {string} HTML output.\n\t */\n\trenderItem( props, template ) {\n\t\tif ( props._embedded && props._embedded.owner ) {\n\t\t\tprops.owner = props._embedded.owner.at( 0 );\n\t\t}\n\n\t\tif ( ! template ) {\n\t\t\ttemplate = this.template;\n\t\t}\n\n\t\tconst Template = setTemplate( template );\n\t\treturn Template( props );\n\t}\n\n\t/**\n\t * Renders Media.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Array} items The list of Attachment objects to render.\n\t */\n\trenderItems( items ) {\n\t\titems.forEach( ( item ) => {\n\t\t\tthis.container.innerHTML += this.renderItem( item );\n\t\t} );\n\n\t\tdocument.querySelectorAll( '.bp-media-item' ).forEach( ( renderedItem ) => {\n\t\t\t// Only show existing media.\n\t\t\tif ( !! renderedItem.innerHTML.trim() ) {\n\t\t\t\trenderedItem.style.height = renderedItem.clientWidth + 'px';\n\t\t\t} else {\n\t\t\t\trenderedItem.style.display = 'none';\n\t\t\t}\n\t\t} );\n\n\t\tthis.loadMore();\n\t}\n\n\t/**\n\t * Renders a skeleton loader when changing scope and filters.\n\t *\n\t * @since 1.0.0\n\t */\n\tdoSkeletonLoading() {\n\t\tconst skeleton = {\n\t\t\tid: 0,\n\t\t\tplaceholder: this.filePlaceholder,\n\t\t};\n\t\tconst template = 'bp-media-skeleton';\n\t\tlet numSkeletons = parseInt( this.queryArgs.per_page, 10 );\n\t\tconst perPage = numSkeletons;\n\t\tconst currentPage = parseInt( this.queryArgs.page, 10 );\n\n\t\t// Reset the container, it it's the first page.\n\t\tif ( 1 === this.queryArgs.page ) {\n\t\t\tthis.container.innerHTML = '';\n\t\t} else {\n\t\t\tconst maxNumDisplayed = currentPage * perPage;\n\t\t\tif ( maxNumDisplayed > this.totalItems ) {\n\t\t\t\tnumSkeletons = this.totalItems - this.items.length;\n\t\t\t}\n\t\t}\n\n\t\tfor ( let i = 0; i < numSkeletons; i++ ) {\n\t\t\tthis.container.innerHTML += this.renderItem( skeleton, template );\n\t\t}\n\t}\n\n\tloadMore() {\n\t\t// Observe the last entry to perform an infinite scroll.\n\t\tlet observedElement = document.querySelector( '.bp-attachments-media-list > div:not(.bp-skeleton):last-child' );\n\t\tlet observer = new IntersectionObserver(\n\t\t\t( entries ) => {\n\t\t\t\tentries.forEach( ( entry ) => {\n\t\t\t\t\tif ( entry.isIntersecting && ! this.isFetching && parseInt( this.queryArgs.page, 10 ) < this.totalPages ) {\n\t\t\t\t\t\tthis.queryArgs.page += 1;\n\n\t\t\t\t\t\t// Load next page.\n\t\t\t\t\t\tthis.query();\n\t\t\t\t\t}\n\t\t\t\t} )\n\t\t\t}, {\n\t\t\t\troot: null,\n\t\t\t\trootMargin: '0px',\n\t\t\t\tthreshold: 1.0,\n\t\t\t}\n\t\t);\n\n\t\tobserver.observe( observedElement );\n\t}\n\n\t/**\n\t * Fetch community media according to query arguments.\n\t *\n\t * @since 1.0.0\n\t */\n\tquery() {\n\t\tthis.doSkeletonLoading();\n\n\t\t// Prevent multiple fetching.\n\t\tthis.isFetching = true;\n\t\tconst currentPage = parseInt( this.queryArgs.page, 10 );\n\t\tconst queryArgs = { ...this.queryArgs };\n\n\t\tif ( 1 === queryArgs.page ) {\n\t\t\tdelete queryArgs.page;\n\t\t}\n\n\t\tsetTimeout( () => {\n\t\t\tfetch( addQueryArgs( this.root + this.endpoint, queryArgs ), {\n\t\t\t\tmethod: 'GET',\n\t\t\t\theaders: {\n\t\t\t\t\t'X-WP-Nonce' : this.nonce,\n\t\t\t\t}\n\t\t\t} ).then(\n\t\t\t\t( response ) => {\n\t\t\t\t\tif ( 200 !== response.status ) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.totalItems = parseInt( response.headers.get( 'X-WP-Total' ), 10 );\n\t\t\t\t\tthis.totalPages = parseInt( response.headers.get( 'X-WP-TotalPages' ), 10 );\n\n\t\t\t\t\t// Release the JSON data.\n\t\t\t\t\treturn response.json();\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t( data ) => {\n\t\t\t\t\tif ( 1 === currentPage ) {\n\t\t\t\t\t\tthis.items = data;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.items = [ ...this.items, data ];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.renderItems( data );\n\n\t\t\t\t\t// Make fetching available again.\n\t\t\t\t\tthis.isFetching = false;\n\t\t\t\t}\n\t\t\t).catch(\n\t\t\t\t() => {\n\t\t\t\t\t// Update query results.\n\t\t\t\t\tthis.items = [];\n\t\t\t\t\tthis.totalItems = 0;\n\t\t\t\t\tthis.totalPages = 1;\n\t\t\t\t}\n\t\t\t).finally(\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.querySelectorAll( '.bp-media-item.skeleton' ).forEach( ( skull ) => skull.remove() );\n\t\t\t\t}\n\t\t\t);\n\t\t}, 500 );\n\t}\n\n\t/**\n\t * Add listeners to catch interface changes made by the user.\n\t *\n\t * @since 1.0.0\n\t */\n\tsetupListeners() {\n\t\tdocument.addEventListener( 'click', ( e ) => {\n\t\t\tconst mainNavItem = e.target.closest( 'li[data-bp-scope]' );\n\n\t\t\tif ( null !== mainNavItem && this.scope !== mainNavItem.dataset.bpScope ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tthis.scope = mainNavItem.dataset.bpScope;\n\t\t\t\tthis.queryArgs.type = mainNavItem.dataset.bpScope;\n\n\t\t\t\tmainNavItem.closest( '.component-navigation' ).childNodes.forEach( ( child ) => {\n\t\t\t\t\tif ( !! child.classList ) {\n\t\t\t\t\t\tif ( mainNavItem.dataset.bpScope === child.dataset.bpScope ) {\n\t\t\t\t\t\t\tchild.classList.add( 'selected' )\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tchild.classList.remove( 'selected' );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\t// Reset the page argument before querying.\n\t\t\t\tthis.queryArgs.page = 1;\n\t\t\t\tthis.query();\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Init the Directory.\n\t *\n\t * @since 1.0.0\n\t */\n\t start() {\n\t\tthis.setupListeners();\n\n\t\tif ( ! this.items || ! this.items.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.container.querySelector( '#bp-attachments-no-media' ).remove();\n\t\tthis.renderItems( this.items );\n\t }\n}\n\nwindow.bp = window.bp || {};\nwindow.bp.Attachments = window.bp.Attachments || {};\n\nconst directorySettings = window.bpAttachmentsDirectorySettings || {};\nwindow.bp.Attachments.Directory = new bpAttachmentsDirectory( directorySettings );\n\ndomReady( () => window.bp.Attachments.Directory.start() );\n"],"names":["template","lodash","domReady","$89823c8e39abf570$var$domReady","url","addQueryArgs","$89823c8e39abf570$var$addQueryArgs","getPath","$89823c8e39abf570$var$getPath","getQueryArgs","$89823c8e39abf570$var$getQueryArgs","wp","window","bp","Attachments","$89823c8e39abf570$var$directorySettings","bpAttachmentsDirectorySettings","Directory","renderItem","props","_embedded","owner","at","this","tmpl","document","querySelector","innerHTML","evaluate","interpolate","escape","variable","renderItems","items","forEach","item","container","querySelectorAll","renderedItem","trim","style","height","clientWidth","display","loadMore","doSkeletonLoading","skeleton","id","placeholder","filePlaceholder","numSkeletons","parseInt","queryArgs","per_page","perPage","currentPage","page","totalItems","length","i","observedElement","IntersectionObserver","entries","entry","isIntersecting","isFetching","totalPages","query","root","rootMargin","threshold","observe","setTimeout","fetch","endpoint","method","headers","nonce","then","response","status","get","json","data","catch","finally","skull","remove","setupListeners","addEventListener","e","mainNavItem","target","closest","scope","dataset","bpScope","preventDefault","type","childNodes","child","classList","add","start","constructor","path","body","replace","Object","keys","header"],"version":3,"file":"directory.js.map"}