{"mappings":"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","sources":["src/media-library/utils/set-template.js","src/front-end/directory.js"],"sourcesContent":["/**\n * External dependencies\n */\nconst { template } = lodash;\n\nfunction setTemplate( tmpl ) {\n\tconst options = {\n\t\tevaluate:    /<#([\\s\\S]+?)#>/g,\n\t\tinterpolate: /\\{\\{\\{([\\s\\S]+?)\\}\\}\\}/g,\n\t\tescape:      /\\{\\{([^\\}]+?)\\}\\}(?!\\})/g,\n\t\tvariable:    'data'\n\t};\n\n\treturn template( document.querySelector( '#tmpl-' + tmpl ).innerHTML, options );\n}\n\nexport default setTemplate;\n","/**\n * WordPress dependencies\n */\nconst {\n\tdomReady,\n\turl: {\n\t\taddQueryArgs,\n\t\tgetPath,\n\t\tgetQueryArgs,\n\t},\n} = wp;\n\n/**\n * Internal dependencies.\n */\nimport setTemplate from '../media-library/utils/set-template';\n\nclass bpAttachmentsDirectory {\n\t/**\n\t * Setup the Directory.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} preloadedData The preloaded data.\n\t */\n\tconstructor( { path, root, nonce, placeholder, items } ) {\n\t\tconst { body } = items;\n\t\tthis.items = body;\n\t\tthis.queryArgs = { ...getQueryArgs( path ), page: 1, per_page: 20 };\n\t\tthis.endpoint = getPath( root.replace( '/wp-json', '' ) + path );\n\t\tthis.root = root;\n\t\tthis.nonce = nonce;\n\t\tthis.scope = 'any';\n\t\tthis.isFetching = false;\n\t\tthis.totalItems = 0;\n\t\tthis.totalPages = 0;\n\t\tthis.template = 'bp-media-item';\n\t\tthis.filePlaceholder = placeholder;\n\t\tthis.container = document.querySelector( '#bp-media-directory' );\n\n\t\tif ( 'headers' in items ) {\n\t\t\tObject.keys( items.headers ).forEach( ( header ) => {\n\t\t\t\tif ( 'X-WP-Total' === header ) {\n\t\t\t\t\tthis.totalItems = parseInt( items.headers[ header ], 10 );\n\t\t\t\t} else if ( 'X-WP-TotalPages' === header ) {\n\t\t\t\t\tthis.totalPages = parseInt( items.headers[ header ], 10 );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * Renders the HTML of a medium.\n\t *\n\t * @since 1.0.0\n\t *\n\t * @param {Object} props The medium properties.\n\t * @returns {string} HTML output.\n\t */\n\trenderItem( props, template ) {\n\t\tif ( props._embedded && props._embedded.owner ) {\n\t\t\tprops.owner = props._embedded.owner.at( 0 );\n\t\t}\n\n\t\tif ( ! template ) {\n\t\t\ttemplate = this.template;\n\t\t}\n\n\t\tconst Template = setTemplate( template );\n\t\treturn Template( props );\n\t}\n\n\t/**\n\t * Renders Media.\n\t *\n\t * @since 1.0.0\n\t */\n\trenderItems( items ) {\n\t\titems.forEach( ( item ) => {\n\t\t\tthis.container.innerHTML += this.renderItem( item );\n\t\t} );\n\n\t\tdocument.querySelectorAll( '.bp-media-item' ).forEach( ( renderedItem ) => {\n\t\t\t// Only show existing media.\n\t\t\tif ( !! renderedItem.innerHTML.trim() ) {\n\t\t\t\trenderedItem.style.height = renderedItem.clientWidth + 'px';\n\t\t\t} else {\n\t\t\t\trenderedItem.style.display = 'none';\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Renders a skeleton loader when changing scope and filters.\n\t *\n\t * @since 1.0.0\n\t */\n\tdoSkeletonLoading() {\n\t\tconst skeleton = {\n\t\t\tid: 0,\n\t\t\tplaceholder: this.filePlaceholder,\n\t\t};\n\t\tconst template = 'bp-media-skeleton';\n\t\tlet numSkeletons = parseInt( this.queryArgs.per_page, 10 );\n\t\tconst perPage = numSkeletons;\n\t\tconst currentPage = parseInt( this.queryArgs.page, 10 );\n\n\t\t// Reset the container, it it's the first page.\n\t\tif ( 1 === this.queryArgs.page ) {\n\t\t\tthis.container.innerHTML = '';\n\t\t} else {\n\t\t\tconst maxNumDisplayed = currentPage * perPage;\n\t\t\tif ( maxNumDisplayed > this.totalItems ) {\n\t\t\t\tnumSkeletons = this.totalItems - this.items.length;\n\t\t\t}\n\t\t}\n\n\t\tfor ( let i = 0; i < numSkeletons; i++ ) {\n\t\t\tthis.container.innerHTML += this.renderItem( skeleton, template );\n\t\t}\n\t}\n\n\t/**\n\t * Fetch community media according to query arguments.\n\t *\n\t * @since 1.0.0\n\t */\n\tquery() {\n\t\tthis.doSkeletonLoading();\n\n\t\t// Prevent multiple fetching.\n\t\tthis.isFetching = true;\n\t\tconst currentPage = parseInt( this.queryArgs.page, 10 );\n\t\tconst queryArgs = { ...this.queryArgs };\n\n\t\tif ( 1 === queryArgs.page ) {\n\t\t\tdelete queryArgs.page;\n\t\t}\n\n\t\tsetTimeout( () => {\n\t\t\tfetch( addQueryArgs( this.root + this.endpoint, queryArgs ), {\n\t\t\t\tmethod: 'GET',\n\t\t\t\theaders: {\n\t\t\t\t\t'X-WP-Nonce' : this.nonce,\n\t\t\t\t}\n\t\t\t} ).then(\n\t\t\t\t( response ) => {\n\t\t\t\t\tif ( 200 !== response.status ) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.totalItems = parseInt( response.headers.get( 'X-WP-Total' ), 10 );\n\t\t\t\t\tthis.totalPages = parseInt( response.headers.get( 'X-WP-TotalPages' ), 10 );\n\n\t\t\t\t\t// Release the JSON data.\n\t\t\t\t\treturn response.json();\n\t\t\t\t}\n\t\t\t).then(\n\t\t\t\t( data ) => {\n\t\t\t\t\tif ( 1 === currentPage ) {\n\t\t\t\t\t\tthis.items = data;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.items = [ ...this.items, data ];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.renderItems( data );\n\n\t\t\t\t\t// Make fetching available again.\n\t\t\t\t\tthis.isFetching = false;\n\t\t\t\t}\n\t\t\t).catch(\n\t\t\t\t() => {\n\t\t\t\t\t// Update query results.\n\t\t\t\t\tthis.items = [];\n\t\t\t\t\tthis.totalItems = 0;\n\t\t\t\t\tthis.totalPages = 1;\n\t\t\t\t}\n\t\t\t).finally(\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.querySelectorAll( '.bp-media-item.skeleton' ).forEach( ( skull ) => skull.remove() );\n\t\t\t\t}\n\t\t\t);\n\t\t}, 500 );\n\t}\n\n\t/**\n\t * Add listeners to catch interface changes made by the user.\n\t *\n\t * @since 1.0.0\n\t */\n\tsetupListeners() {\n\t\tdocument.addEventListener( 'click', ( e ) => {\n\t\t\tconst mainNavItem = e.target.closest( 'li[data-bp-scope]' );\n\n\t\t\tif ( null !== mainNavItem && this.scope !== mainNavItem.dataset.bpScope ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tthis.scope = mainNavItem.dataset.bpScope;\n\t\t\t\tthis.queryArgs.type = mainNavItem.dataset.bpScope;\n\n\t\t\t\tmainNavItem.closest( '.component-navigation' ).childNodes.forEach( ( child ) => {\n\t\t\t\t\tif ( !! child.classList ) {\n\t\t\t\t\t\tif ( mainNavItem.dataset.bpScope === child.dataset.bpScope ) {\n\t\t\t\t\t\t\tchild.classList.add( 'selected' )\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tchild.classList.remove( 'selected' );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\t// Reset the page argument before querying.\n\t\t\t\tthis.queryArgs.page = 1;\n\t\t\t\tthis.query();\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Init the Directory.\n\t *\n\t * @since 1.0.0\n\t */\n\t start() {\n\t\tthis.setupListeners();\n\n\t\tif ( ! this.items || ! this.items.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderItems( this.items );\n\t }\n}\n\nwindow.bp = window.bp || {};\nwindow.bp.Attachments = window.bp.Attachments || {};\n\nconst directorySettings = window.bpAttachmentsDirectorySettings || {};\nwindow.bp.Attachments.Directory = new bpAttachmentsDirectory( directorySettings );\n\ndomReady( () => window.bp.Attachments.Directory.start() );\n"],"names":["template","lodash","domReady","$89823c8e39abf570$var$domReady","url","addQueryArgs","$89823c8e39abf570$var$addQueryArgs","getPath","$89823c8e39abf570$var$getPath","getQueryArgs","$89823c8e39abf570$var$getQueryArgs","wp","window","bp","Attachments","$89823c8e39abf570$var$directorySettings","bpAttachmentsDirectorySettings","Directory","renderItem","props","_embedded","owner","at","this","tmpl","document","querySelector","innerHTML","evaluate","interpolate","escape","variable","renderItems","items","forEach","item","container","querySelectorAll","renderedItem","trim","style","height","clientWidth","display","doSkeletonLoading","skeleton","id","placeholder","filePlaceholder","numSkeletons","parseInt","queryArgs","per_page","perPage","currentPage","page","totalItems","length","i","query","isFetching","setTimeout","fetch","root","endpoint","method","headers","nonce","then","response","status","get","totalPages","json","data","catch","finally","skull","remove","setupListeners","addEventListener","e","mainNavItem","target","closest","scope","dataset","bpScope","preventDefault","type","childNodes","child","classList","add","start","constructor","path","body","replace","Object","keys","header"],"version":3,"file":"directory.js.map"}