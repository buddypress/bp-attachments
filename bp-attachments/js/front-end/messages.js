!function(){const{template:e}=lodash;const{i18n:{__:t}}=wp,{filter:s}=lodash;var a=e=>{const s=[t("Bytes","bp-attachments"),t("KB","bp-attachments"),t("MB","bp-attachments"),t("GB","bp-attachments"),t("TB","bp-attachments")];if(0===e)return"0 "+s[0];const a=parseInt(Math.floor(Math.log(e)/Math.log(1024)),10);return 0===a?`${e} ${s[a]}`:`${(e/1024**a).toFixed(1)} ${s[a]}`};const{domReady:n}=wp;window.bp=window.bp||{},window.bp.Attachments=window.bp.Attachments||{};const i=window.bpAttachmentsMessagesSettings||{};window.bp.Attachments.Messages=new class{renderItemPreview(t){var s;return(s="bp-media-preview",e(document.querySelector("#tmpl-"+s).innerHTML,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"}))(t)}reset(){document.querySelector("#bp-attachments-messages-medium-preview").innerHTML=""}upload(){const e=document.createElement("input");e.type="file",e.id="bp-attachments-messages-medium",e.name="_bp_attachments_messages_medium",e.style="display: none;",e.accept=this.allowedTypes,this.container.querySelector("#bp-attachments-messages-medium")||(this.reset(),this.container.append(e)),e.click(),e.addEventListener("change",(e=>{e.preventDefault();const t=e.target.files[0];if(t&&-1===this.uploadedFiles.indexOf(t.name)){this.container.querySelector(".bp-attachments-messages-file").style="visibility: hidden;",this.uploadedFiles.push(t.name);const e=new FormData;e.append("file",t),e.append("action","bp_attachments_media_upload"),e.append("object","members"),e.append("object_item",this.userId),e.append("visibility","private"),e.append("total_bytes",t.size),fetch(this.endpoint,{method:"POST",body:e,headers:{"X-WP-Nonce":this.nonce}}).then((e=>e.json())).then((e=>{e.code&&e.message?console.log(e.message):(e.size&&(e.size=a(e.size)),this.container.querySelector("#bp-attachments-messages-medium-preview").innerHTML=this.renderItemPreview(e))})).finally((()=>{this.container.querySelector("#bp-attachments-messages-medium").remove()}))}}))}start(){const{bp:{Nouveau:{Messages:{views:e}}}}=window,t=document.createElement("div");t.id="bp-attachments-messages-medium-preview",document.addEventListener("click",(e=>e.target.classList.contains("bp-attachments-messages-file")?(e.preventDefault(),this.container=e.target.closest(".bp-attachments-messages-button-container"),this.container.prepend(t),this.upload()):"bp-attachments-medium-preview-exit"===e.target.getAttribute("id")?(e.preventDefault(),this.container.querySelector(".bp-attachments-messages-file").style="visibility: visible;",this.reset()):void 0)),e.on("compose:resetForm",(()=>{this.reset(),this.container.querySelector(".bp-attachments-messages-file").style="visibility: visible;"}))}constructor({path:e,root:t,nonce:s,allowedExtTypes:a,userId:n}){this.endpoint=t+e,this.nonce=s,this.allowedTypes=a,this.userId=n,this.uploadedFiles=[],this.container=null}}(i),n((()=>window.bp.Attachments.Messages.start()))}();
//# sourceMappingURL=messages.js.map
