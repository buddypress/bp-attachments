!function(){function e(e,t,a,r){Object.defineProperty(e,t,{get:a,set:r,enumerable:!0,configurable:!0})}const t="bp/attachments";var a={};e(a,"getSettings",(function(){return m})),e(a,"getRequestsContext",(function(){return h})),e(a,"isGridDisplayMode",(function(){return y})),e(a,"getLoggedInUser",(function(){return b})),e(a,"getFormState",(function(){return E})),e(a,"isUploading",(function(){return _})),e(a,"uploadEnded",(function(){return f})),e(a,"getUploads",(function(){return g})),e(a,"getErrors",(function(){return v})),e(a,"getMedia",(function(){return D})),e(a,"getCurrentDirectory",(function(){return T})),e(a,"getCurrentDirectoryObject",(function(){return S})),e(a,"getTree",(function(){return M})),e(a,"getFlatTree",(function(){return A})),e(a,"isSelectable",(function(){return R})),e(a,"selectedMedia",(function(){return O})),e(a,"getRelativePath",(function(){return N})),e(a,"getDestinationData",(function(){return I}));const{i18n:{__:r}}=wp,{filter:n}=lodash,i=(e,t)=>{let a=n(e,{id:t});return a.forEach((t=>{const r=i(e,t.parent);a=[...a,...r]})),a},s=e=>{const t=[r("Bytes","bp-attachments"),r("KB","bp-attachments"),r("MB","bp-attachments"),r("GB","bp-attachments"),r("TB","bp-attachments")];if(0===e)return"0 "+t[0];const a=parseInt(Math.floor(Math.log(e)/Math.log(1024)),10);return 0===a?`${e} ${t[a]}`:`${(e/1024**a).toFixed(1)} ${t[a]}`},{trim:o,groupBy:c,filter:l,indexOf:d,find:u,defaultTo:p}=lodash,m=e=>{const{settings:t}=e;return t},h=e=>{const{settings:{isAdminScreen:t}}=e;return!0===t?"edit":"view"},y=e=>{const{isGrid:t}=e;return t},b=e=>{const{user:t}=e;return t},E=e=>{const{formState:t}=e;return t},_=e=>{const{uploading:t}=e;return t},f=e=>{const{ended:t}=e;return t},g=e=>{const{uploads:t}=e;return t},v=e=>{const{errors:t}=e;return t},D=e=>{const{files:t}=e;return t},T=e=>{const{currentDirectory:t}=e;return t||""},S=e=>{const{currentDirectory:t,tree:a}=e,r={readonly:!0};return""!==t?p(u(a,{id:t}),r):r},M=e=>{const{tree:t,currentDirectory:a}=e,r=c(t,"parent"),n=l(t,{parent:a||0}).map((e=>e.id));if(n&&n.length&&n.forEach((e=>{r[e]&&delete r[e]})),a){const e=i(t,a).map((e=>e.id));Object.keys(r).forEach((t=>{0!==parseInt(t,10)&&-1===d(e,t)&&delete r[t]}))}const s=e=>e.map((e=>{const t=r[e.id];return{...e,children:t&&t.length?s(t):[]}}));return s(r[0]||[])},A=e=>{const{tree:t}=e;return t||[]},R=e=>{const{isSelectable:t}=e;return t},O=e=>{const{files:t}=e;return l(t,["selected",!0])},N=e=>{const{relativePath:t}=e;return t},I=e=>{const{relativePath:t}=e;if(!t)return{object:"members"};const a=o(t,"/").split("/");return{visibility:a[0]?a[0]:"public",object:a[1]?a[1]:"members",item:a[2]?a[2]:""}};var P={};e(P,"setSettings",(function(){return B})),e(P,"fetchFromAPI",(function(){return H})),e(P,"createFromAPI",(function(){return q})),e(P,"updateFromAPI",(function(){return V})),e(P,"deleteFromAPI",(function(){return $})),e(P,"switchDisplayMode",(function(){return W})),e(P,"getLoggedInUser",(function(){return Y})),e(P,"getMedia",(function(){return z})),e(P,"updateFormState",(function(){return X})),e(P,"initTree",(function(){return Q})),e(P,"addItemTree",(function(){return Z})),e(P,"removeItemTree",(function(){return J})),e(P,"toggleSelectable",(function(){return ee})),e(P,"toggleMediaSelection",(function(){return te})),e(P,"addMedium",(function(){return ae})),e(P,"addMediumError",(function(){return re})),e(P,"createMedium",(function(){return ne})),e(P,"createDirectory",(function(){return ie})),e(P,"updateMedium",(function(){return se})),e(P,"parseResponseMedia",(function(){return oe})),e(P,"requestMedia",(function(){return ce})),e(P,"removeMedium",(function(){return le})),e(P,"deleteMedium",(function(){return de})),e(P,"removeMediumError",(function(){return ue}));const w={SET_SETTINGS:"SET_SETTINGS",GET_LOGGED_IN_USER:"GET_LOGGED_IN_USER",GET_MEDIA:"GET_MEDIA",ADD_MEDIUM:"ADD_MEDIUM",FILL_TREE:"FILL_TREE",PURGE_TREE:"PURGE_TREE",REMOVE_MEDIUM:"REMOVE_MEDIUM",FETCH_FROM_API:"FETCH_FROM_API",CREATE_FROM_API:"CREATE_FROM_API",UPDATE_FROM_API:"UPDATE_FROM_API",DELETE_FROM_API:"DELETE_FROM_API",UPLOAD_START:"UPLOAD_START",UPLOAD_END:"UPLOAD_END",RESET_UPLOADS:"RESET_UPLOADS",ADD_ERROR:"ADD_ERROR",REMOVE_ERROR:"REMOVE_ERROR",TOGGLE_SELECTABLE:"TOGGLE_SELECTABLE",TOGGLE_MEDIA_SELECTION:"TOGGLE_MEDIA_SELECTION",SWITCH_DISPLAY_MODE:"SWITCH_DISPLAY_MODE",UPDATE_FORM_STATE:"UPDATE_FORM_STATE"},{uniqueId:L,hasIn:C,trim:F,trimEnd:U,filter:G}=lodash,{data:{dispatch:j,select:x},url:{addQueryArgs:k}}=wp;function B(e){return{type:w.SET_SETTINGS,settings:e}}function H(e,t){return{type:w.FETCH_FROM_API,path:e,parse:t}}function q(e,t){return{type:w.CREATE_FROM_API,path:e,data:t}}function V(e,t){return{type:w.UPDATE_FROM_API,path:e,data:t}}function $(e,t){return{type:w.DELETE_FROM_API,path:e,relativePath:t}}function W(e){return{type:w.SWITCH_DISPLAY_MODE,isGrid:e}}function Y(e){return{type:w.GET_LOGGED_IN_USER,user:e}}function z(e,t,a){return{type:w.GET_MEDIA,files:e,relativePath:t,currentDirectory:a}}function X(e){return{type:w.UPDATE_FORM_STATE,params:e}}const K=(e,t)=>({id:e.id,slug:e.name,name:e.title,parent:t,object:e.object?e.object:"members",readonly:!!e.readonly&&e.readonly,visibility:e.visibility?e.visibility:"public",type:e.media_type?e.media_type:"folder"});function Q(e){const a=x(t).getTree(),r=G(e,{mime_type:"inode/directory"});a.length||r.forEach((e=>{const a=K(e,0);j(t).addItemTree(a)}))}function Z(e){return{type:w.FILL_TREE,item:e}}function J(e){return{type:w.PURGE_TREE,itemId:e}}function ee(e){return{type:w.TOGGLE_SELECTABLE,isSelectable:e}}function te(e,t){return{type:w.TOGGLE_MEDIA_SELECTION,ids:e,isSelected:t}}function ae(e){return{type:w.ADD_MEDIUM,file:e}}function re(e){return{type:w.ADD_ERROR,error:e}}function*ne(e){let a,r=!0;const n=x(t),{object:i,item:s,visibility:o}=n.getDestinationData(),c=n.getRelativePath();yield{type:"UPLOAD_START",uploading:r,file:e};const l=new FormData;if(l.append("file",e),l.append("action","bp_attachments_media_upload"),l.append("object",i),l.append("object_item",s),o&&l.append("visibility",o),F(c,"/")!==o+"/"+i+"/"+s){let e=c;"private"===o&&(e=c.replace("/private","")),l.append("parent_dir",e)}r=!1;try{return a=yield q("/buddypress/v1/attachments",l),yield{type:"UPLOAD_END",uploading:r,file:e},ae(a)}catch(t){return a={id:L(),name:e.name,error:t.message,uploaded:!1},yield{type:"UPLOAD_END",uploading:r,file:e},re(a)}}function*ie(e){let a,r=!0,n={name:e.directoryName,type:e.directoryType};const i=x(t),{object:s,item:o,visibility:c}=i.getDestinationData(),l=i.getRelativePath();yield{type:"UPLOAD_START",uploading:r,file:n};const d=new FormData;if(d.append("directory_name",n.name),d.append("directory_type",n.type),d.append("action","bp_attachments_make_directory"),d.append("object",s),d.append("object_item",o),c&&d.append("visibility",c),F(l,"/")!==c+"/"+s+"/"+o){let e=l;"private"===c&&(e=l.replace("/private","")),d.append("parent_dir",e)}r=!1;try{a=yield q("/buddypress/v1/attachments",d),yield{type:"UPLOAD_END",uploading:r,file:n},a.uploaded=!0;const e=i.getCurrentDirectoryObject(),t=K(a,e.id);return yield Z(t),ae(a)}catch(e){return a={id:L(),name:n.name,error:e.message,uploaded:!1},yield{type:"UPLOAD_END",uploading:r,file:n},re(a)}}function*se(e){let a;const r=x(t).getRelativePath();try{return a=yield V("/buddypress/v1/attachments/"+e.id+"/",{relative_path:r,title:e.title,description:e.description}),e.selected&&(a.selected=!0),ae(a)}catch(t){return a={id:L(),name:e.name,error:t.message,updated:!1},re(a)}}const oe=async function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const n=await e.json().then((e=>(e.forEach((e=>{if(e.parent=r,"inode/directory"===e.mime_type){const a=K(e,r);j(t).addItemTree(a)}})),e)));a||r||Q(n),j(t).getMedia(n,a,r)};function*ce(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a="/buddypress/v1/attachments";let r="",n="";e.context||(e.context=x(t).getRequestsContext()),e.directory&&e.path&&(e.directory=U(e.path,"/")+"/"+e.directory),e.parent&&(n=e.parent,delete e.parent),delete e.path;const i=yield H(k(a,e),!1);return r=C(i,["headers","get"])?i.headers.get("X-BP-Attachments-Relative-Path"):get(i,["headers","X-BP-Attachments-Relative-Path"],""),oe(i,r,n)}function le(e){return{type:"REMOVE_MEDIUM",id:e}}function*de(e){const a=x(t).getRelativePath();let r;try{return r=yield $("/buddypress/v1/attachments/"+e.id+"/",a),"inode/directory"===r.previous.mime_type&&(yield J(r.previous.id)),le(r.previous.id)}catch(t){return e.error=t.message,re(e)}}function ue(e){return{type:w.REMOVE_ERROR,errorID:e}}var pe={};e(pe,"getLoggedInUser",(function(){return he})),e(pe,"getMedia",(function(){return ye}));const{filter:me}=lodash;function*he(){const e=yield H("/buddypress/v1/members/me?context=edit",!0);yield Y(e)}function*ye(){const e="/buddypress/v1/attachments?context="+(()=>{const{isAdminScreen:e}=window.bpAttachmentsMediaLibrarySettings||{};return e&&!0===e?"edit":"view"})(),t=yield H(e,!0);Q(t),yield z(t,"")}const{reject:be}=lodash,Ee={user:{},tree:[],currentDirectory:"",files:[],relativePath:"",uploads:[],errors:[],uploading:!1,ended:!1,isSelectable:!1,isGrid:!0,settings:{},formState:{}};var _e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w.SET_SETTINGS:return{...e,settings:t.settings};case w.GET_LOGGED_IN_USER:return{...e,user:t.user};case w.GET_MEDIA:return{...e,files:t.files,relativePath:t.relativePath,currentDirectory:t.currentDirectory};case w.FILL_TREE:return{...e,tree:[...be(e.tree,["id",t.item.id]),t.item]};case w.PURGE_TREE:return{...e,tree:be(e.tree,["id",t.itemId])};case w.UPDATE_FORM_STATE:return{...e,formState:t.params};case w.ADD_MEDIUM:return{...e,files:[...be(e.files,["id",t.file.id]),t.file]};case w.UPLOAD_START:return{...e,uploading:t.uploading,uploads:[...e.uploads,t.file]};case w.ADD_ERROR:return{...e,errors:[...e.errors,t.error]};case w.REMOVE_ERROR:return{...e,errors:be(e.errors,["id",t.errorID])};case w.UPLOAD_END:return{...e,uploading:t.uploading,uploads:be(e.uploads,(e=>e.name===t.file.name)),ended:!0};case w.RESET_UPLOADS:return{...e,uploading:!1,uploads:[],errors:[],ended:!1};case w.TOGGLE_SELECTABLE:return{...e,isSelectable:t.isSelectable};case w.TOGGLE_MEDIA_SELECTION:return{...e,files:e.files.map((e=>(("all"===t.ids[0]&&!t.isSelected||-1!==t.ids.indexOf(e.id))&&(e.selected=t.isSelected),e)))};case w.SWITCH_DISPLAY_MODE:return{...e,isGrid:t.isGrid};case w.REMOVE_MEDIUM:return{...e,files:[...be(e.files,["id",t.id])]}}return e};const{apiFetch:fe}=wp,ge={FETCH_FROM_API(e){let{path:t,parse:a}=e;return fe({path:t,parse:a})},CREATE_FROM_API(e){let{path:t,data:a}=e;return fe({path:t,method:"POST",body:a})},UPDATE_FROM_API(e){let{path:t,data:a}=e;return fe({path:t,method:"PUT",data:a})},DELETE_FROM_API(e){let{path:t,relativePath:a}=e;return fe({path:t,method:"DELETE",data:{relative_path:a}})}},{data:{registerStore:ve}}=wp;ve(t,{reducer:_e,actions:P,selectors:a,controls:ge,resolvers:pe});const De=t,{components:{Popover:Te},data:{useDispatch:Se,useSelect:Me},element:{createElement:Ae,Fragment:Re,useState:Oe},i18n:{__:Ne}}=wp;var Ie=e=>{let{settings:t}=e;const{updateFormState:a}=Se(De),r=Me((e=>e(De).getCurrentDirectoryObject()),[]),[n,i]=Oe(!1),s=!0===n?"split-button is-open":"split-button",o=!0===n?"dashicons dashicons-arrow-up-alt2":"dashicons dashicons-arrow-down-alt2",c=!0!==r.readonly,{allowedExtByMediaList:l}=t,d=e=>(e.preventDefault(),a({parentDirectory:r.id,action:"upload"}));let u=[];r.type&&-1!==["album","audio_playlist","video_playlist"].indexOf(r.type)||(u=[{id:"folder",text:Ne("Add new directory","bp-attachments")}],l&&"private"!==r.visibility&&Object.keys(l).forEach((e=>{"album"===e?u.push({id:"album",text:Ne("Add new photo album","bp-attachments")}):"audio_playlist"===e?u.push({id:"audio_playlist",text:Ne("Add new audio playlist","bp-attachments")}):"video_playlist"===e&&u.push({id:"video_playlist",text:Ne("Add new video playlist","bp-attachments")})})));const p=u.map((e=>Ae("li",{key:"type-"+e.id},Ae("a",{href:"#new-bp-media-directory",className:"button-link directory-button split-button-option",onClick:t=>((e,t)=>(e.preventDefault(),a({parentDirectory:r.id,action:"createDirectory",directoryType:t})))(t,e.id)},e.text))));return Ae(Re,null,Ae("h1",{className:"wp-heading-inline"},Ne("Community Media Library","bp-attachments")),!!c&&Ae("div",{className:s},Ae("div",{className:"split-button-head"},Ae("a",{href:"#new-bp-media-upload",className:"button split-button-primary","aria-live":"polite",onClick:e=>d(e)},Ne("Add new","bp-attachments")),Ae("button",{type:"button",className:"split-button-toggle","aria-haspopup":"true","aria-expanded":n,onClick:()=>i(!n)},Ae("i",{className:o}),Ae("span",{className:"screen-reader-text"},Ne("More actions","bp-attachments")),n&&Ae(Te,{noArrow:!1,onFocusOutside:()=>i(!n)},Ae("ul",{className:"split-button-body"},Ae("li",null,Ae("a",{href:"#new-bp-media-upload",className:"button-link media-button split-button-option",onClick:e=>d(e)},Ne("Upload media","bp-attachments"))),p))))),Ae("hr",{className:"wp-header-end"}))};const{components:{DropZone:Pe,FormFileUpload:we},data:{useDispatch:Le,useSelect:Ce},element:{createElement:Fe},i18n:{__:Ue,sprintf:Ge}}=wp;var je=e=>{let{settings:t}=e;const{maxUploadFileSize:a,allowedExtTypes:r,allowedExtByMediaList:n}=t,{updateFormState:i,createMedium:o}=Le(De),{formState:c,currentDirectoryObject:l}=Ce((e=>{const t=e(De);return{formState:t.getFormState(),currentDirectoryObject:t.getCurrentDirectoryObject()}}),[]),d=()=>(c.action="",i(c)),u=e=>{let t;t=e.currentTarget&&e.currentTarget.files?[...e.currentTarget.files]:e,t.forEach((e=>{o(e)})),d()};if(!c.action||"upload"!==c.action)return null;let p=r;return l.type&&-1!==["album","audio_playlist","video_playlist"].indexOf(l.type)&&(p=n[l.type]),Fe("div",{className:"uploader-container enabled"},Fe(Pe,{label:Ue("Drop your files here.","bp-attachments"),onFilesDrop:e=>u(e),className:"uploader-inline"}),Fe("button",{className:"close dashicons dashicons-no",onClick:e=>(e=>{e.preventDefault(),d()})(e)},Fe("span",{className:"screen-reader-text"},Ue("Close the upload panel","bp-attachments"))),Fe("div",{className:"dropzone-label"},Fe("h2",{className:"upload-instructions drop-instructions"},Ue("Drop files to upload","bp-attachments")),Fe("p",{className:"upload-instructions drop-instructions"},Ue("or","bp-attachments")),Fe(we,{onChange:e=>u(e),multiple:!0,accept:p,className:"browser button button-hero"},Ue("Select Files","bp-attachments"))),Fe("div",{className:"upload-restrictions"},Fe("p",null,Ge(Ue("Maximum upload file size: %s.","bp-attachments"),s(a)))))};const{components:{Button:xe,TextControl:ke},data:{useDispatch:Be,useSelect:He},element:{createElement:qe,useState:Ve},i18n:{__:$e}}=wp;var We=()=>{const[e,t]=Ve(""),{updateFormState:a,createDirectory:r}=Be(De),n=He((e=>e(De).getFormState()),[]),i=()=>(n.action="",n.directoryType="",a(n));if(!n.action||"createDirectory"!==n.action)return null;let s=$e("Create a new directory","bp-attachments"),o=$e("Type a name for your directory","bp-attachments"),c=$e("Save directory","bp-attachments");return"album"===n.directoryType?(s=$e("Create a new photo album","bp-attachments"),o=$e("Type a name for your photo album","bp-attachments"),c=$e("Save photo album","bp-attachments")):"audio_playlist"===n.directoryType?(s=$e("Create a new audio playlist","bp-attachments"),o=$e("Type a name for your audio playlist","bp-attachments"),c=$e("Save audio playlist","bp-attachments")):"video_playlist"===n.directoryType&&(s=$e("Create a new video playlist","bp-attachments"),o=$e("Type a name for your video playlist","bp-attachments"),c=$e("Save video playlist","bp-attachments")),qe("form",{id:"bp-media-directory-form",className:"directory-creator-container enabled"},qe("button",{className:"close dashicons dashicons-no",onClick:e=>(e=>{e.preventDefault(),i()})(e)},qe("span",{className:"screen-reader-text"},$e("Close the Create directory form","bp-attachments"))),qe("h2",null,s),qe(ke,{label:o,value:e,onChange:e=>t(e)}),qe(xe,{variant:"primary",onClick:a=>(a=>{a.preventDefault();const s={directoryName:e,directoryType:n.directoryType};r(s),t(""),i()})(a)},c))};const{components:{Button:Ye,ExternalLink:ze,TextareaControl:Xe,TextControl:Ke},data:{useDispatch:Qe},element:{createElement:Ze,useState:Je},i18n:{__:et,sprintf:tt}}=wp;var at=e=>{let{medium:t,errorCallback:a}=e;const{id:r,name:n,title:i,description:s,icon:o,media_type:c,mime_type:l,selected:d,links:{view:u,download:p,src:m}}=t,[h,y]=Je({title:i,description:s}),{updateMedium:b}=Qe(De),E=i===h.title&&s===h.description,_=-1===["image","video","audio"].indexOf(c);let f=["bp-attachment-edit-item__preview_illustration"];_||f.push("has-rich-preview");const g="inode/directory"===l;return Ze("div",{className:"bp-attachment-edit-item"},Ze("div",{className:"bp-attachment-edit-item__preview"},Ze("h3",{className:"bp-attachment-edit-item__preview_title"},h.title),Ze("div",{className:"bp-attachment-edit-item__preview_content"},Ze("ul",{className:"bp-attachment-edit-item__preview_links"},Ze("li",null,Ze(ze,{href:u},et(g?"Open directory page":"Open media page","bp-attachments"))),!g&&Ze("li",null,Ze("a",{href:p},et("Download media","bp-attachments")))),Ze("div",{className:f.join(" ")},_&&Ze("img",{src:o,className:"bp-attachment-medium-icon"}),"image"===c&&m&&Ze("img",{src:m,className:"bp-attachment-medium-vignette"}),"audio"===c&&m&&Ze("audio",{controls:"controls",preload:"metadata",className:"bp-attachment-medium-player"},Ze("source",{src:m,type:l})),"video"===c&&m&&Ze("video",{controls:"controls",muted:!0,preload:"metadata",className:"bp-attachment-medium-player"},Ze("source",{src:m,type:l}))),Ze("div",{className:"bp-attachment-edit-item__preview_description"},Ze("p",null,h.description)))),Ze("div",{className:"bp-attachment-edit-item__form"},Ze("h3",null,tt(et("Edit %s","bp-attachments"),n)),Ze("p",{className:"description"},et("Use the below fields to edit media properties.","bp-attachments")),Ze(Ke,{label:et("Title","bp-attachments"),value:h.title,onChange:e=>y({...h,title:e}),help:et("Change the title of your medium to something more descriptive then its file name.","bp-attachments")}),Ze(Xe,{label:et("Description","bp-attachments"),value:h.description,onChange:e=>y({...h,description:e}),help:et("Add or edit the description of your medium to tell your story about it.","bp-attachments")}),Ze("div",{className:"bp-attachment-edit-item__form-actions"},Ze(Ye,{variant:"primary",disabled:E,onClick:e=>(e.preventDefault(),void b({id:r,name:n,title:h.title,description:h.description,selected:d}).then((e=>{e.error?a(!1):e.file&&y({...h,title:e.file.title,description:e.file.description})})))},et("Save your edits","bp-attachment")),Ze(Ye,{variant:"tertiary",disabled:E,onClick:e=>(e.preventDefault(),void y({...h,title:i,description:s}))},et("Cancel","bp-attachment")))))};const{find:rt,reverse:nt}=lodash,{components:{Button:it,Modal:st,TreeSelect:ot},element:{createElement:ct,useState:lt},data:{useDispatch:dt,useSelect:ut},hooks:{applyFilters:pt},i18n:{__:mt}}=wp;var ht=e=>{let{gridDisplay:t,tree:a}=e;const{switchDisplayMode:r,requestMedia:n,toggleSelectable:s,toggleMediaSelection:o,deleteMedium:c}=dt(De),{user:l,currentDirectory:d,currentDirectoryObject:u,flatTree:p,isSelectable:m,selectedMedia:h}=ut((e=>{const t=e(De);return{user:t.getLoggedInUser(),currentDirectory:t.getCurrentDirectory(),currentDirectoryObject:t.getCurrentDirectoryObject(),flatTree:t.getFlatTree(),isSelectable:t.isSelectable(),selectedMedia:t.selectedMedia()}}),[]),[y,b]=lt(d),[E,_]=lt(!1),f=!0!==u.readonly,g=m&&0!==h.length,v=m&&1===h.length;d!==y&&b(d);const D=(e,t)=>{e.preventDefault(),r(t)};return ct("div",{className:"media-toolbar wp-filter"},ct("div",{className:"media-toolbar-secondary"},!m&&ct("div",{className:"view-switch media-grid-view-switch"},ct("a",{href:"#view-list",onClick:e=>D(e,!1),className:t?"view-list":"view-list current"},ct("span",{className:"screen-reader-text"},mt("Display list","bp-attachments"))),ct("a",{href:"#view-grid",onClick:e=>D(e,!0),className:t?"view-grid current":"view-grid"},ct("span",{className:"screen-reader-text"},mt("Display grid","bp-attachments")))),f&&ct(it,{variant:"secondary",className:"media-button select-mode-toggle-button",onClick:e=>(e=>{e.preventDefault();const t=!m;return t||o(["all"],t),s(t)})(e)},mt(m?"Cancel Selection":"Select","bp-attachments")),f&&v&&ct(it,{variant:"primary",className:"media-button edit-selected-button",onClick:e=>(e.preventDefault(),void _(!0))},mt("Edit","bp-attachments")),f&&g&&ct(it,{variant:"tertiary",className:"media-button delete-selected-button",onClick:e=>(e.preventDefault(),h.forEach((e=>{c(e)})),s(!1))},mt("Delete selection","bp-attachments")),E&&ct(st,{title:mt("Media details","bp-attachments"),onRequestClose:()=>_(!1)},ct(at,{medium:h[0],errorCallback:_}))),!!a.length&&ct("div",{className:"media-toolbar-primary"},ct(ot,{noOptionLabel:mt("Home","bp-attachments"),onChange:e=>(e=>{b(e);const t=rt(p,{id:e});let a={};if(t){if(a.directory=t.slug,a.parent=t.id,t.parent&&t.object){let e=nt(i(p,t.parent).map((e=>e.slug)));if("members"===t.object){const a=e.indexOf("member");-1!==a&&e.splice(a,1),e.length&&e.splice(1,0,t.object,l.id)}else e=pt("buddypress.Attachments.toolbarTreeSelect.pathArray",e,t,l.id);a.path="/"+e.join("/")}t.object&&(a.object=t.object)}return n(a)})(e),selectedId:y,tree:a})))};const{template:yt}=lodash;const{element:{createElement:bt,Fragment:Et,useState:_t},components:{Modal:ft},i18n:{__:gt},data:{useSelect:vt,useDispatch:Dt}}=wp;var Tt=e=>{const t=(a="bp-attachments-media-item",yt(document.querySelector("#tmpl-"+a).innerHTML,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"}));var a;const{medium:r,selected:n}=e,{toggleMediaSelection:i,requestMedia:s}=Dt(De),[o,c]=_t(!1),[l,d]=_t(n),{getRelativePath:u,isSelectable:p}=vt((e=>{const t=e(De);return{getRelativePath:t.getRelativePath(),isSelectable:t.isSelectable()}}),[]);p||n||!l||d(!1);return bt(Et,null,bt("div",{className:l?"media-item selected":"media-item",dangerouslySetInnerHTML:{__html:t(e)},role:"checkbox",onClick:()=>(()=>{const{mimeType:t,name:a,isSelectable:r,id:n,object:o}=e;return r?(d(!l),i([n],!l)):"inode/directory"===t?s({directory:a,path:u,object:o,parent:n}):void c(!0)})()}),o&&bt(ft,{title:gt("Media details","bp-attachments"),onRequestClose:()=>c(!1)},bt(at,{medium:r,errorCallback:c})))};const{components:{Animate:St,Dashicon:Mt,Notice:At},element:{createElement:Rt,Fragment:Ot},i18n:{__:Nt,sprintf:It},data:{useSelect:Pt,useDispatch:wt}}=wp;var Lt=()=>{const{uploads:e,errors:t}=Pt((e=>{const t=e(De);return{uploads:t.getUploads(),errors:t.getErrors()}}),[]),{removeMediumError:a}=wt(De);let r=[];t&&t.length&&(r=t.map((e=>Rt(At,{key:"error-"+e.id,status:"error",onRemove:()=>{return t=e.id,a(t);var t},isDismissible:!0},Rt("p",null,Rt(Mt,{icon:"warning"}),It(Nt("« %1$s » wasn‘t added to the media library. %2$s","bp-attachments"),e.name,e.error))))));let n=null;const i=e&&e.length?e.length:0;if(i){let e=Nt("Uploading the media, please wait.","bp-attachments");i>1&&(e=It(Nt("Uploading %d media, please wait.","bp-attachments"),i)),n=Rt("div",{className:"chargement-de-documents"},Rt(St,{type:"loading"},(t=>{let{className:a}=t;return Rt(At,{status:"warning",isDismissible:!1},Rt("p",{className:a},Rt(Mt,{icon:"update"}),e))})))}return Rt("div",{className:"bp-attachments-notices"},n,r)};const{element:{createElement:Ct,Fragment:Ft},i18n:{__:Ut},data:{useSelect:Gt,useDispatch:jt}}=wp;var xt=e=>{let{gridDisplay:t,tree:a}=e;const{items:r,isSelectable:n}=Gt((e=>{const t=e(De);return{items:t.getMedia(),isSelectable:t.isSelectable()}}),[]);let i=null;return r.length&&(i=r.map((e=>Ct(Tt,{key:"media-item-"+e.id,id:e.id,name:e.name,title:e.title,mediaType:e.media_type,mimeType:e.mime_type,icon:e.icon,vignette:e.vignette,orientation:e.orientation,isSelected:e.selected||!1,object:e.object||"members",isSelectable:n,tree:a,medium:e})))),Ct("main",{className:"bp-user-media"},Ct(Lt,null),Ct("div",{className:n?"media-items mode-select":"media-items"},i,!r.length&&Ct("p",{className:"no-media"},Ut("No community media items found.","bp-attachments"))))};const{domReady:kt,element:{createElement:Bt,render:Ht,Fragment:qt},i18n:{__:Vt},data:{useSelect:$t,useDispatch:Wt}}=wp,Yt=e=>{let{settings:t}=e;const{isGrid:a,globalSettings:r,tree:n}=$t((e=>{const t=e(De);return{isGrid:t.isGridDisplayMode(),globalSettings:t.getSettings(),tree:t.getTree()}}),[]);if(!Object.keys(r).length){const{setSettings:e}=Wt(De);e(t)}return Bt(qt,null,Bt(Ie,{settings:r}),Bt(je,{settings:r}),Bt(We,null),Bt(ht,{gridDisplay:a,tree:n}),Bt(xt,{gridDisplay:a,tree:n}))};kt((function(){const e=window.bpAttachmentsMediaLibrarySettings||{};Ht(Bt(Yt,{settings:e}),document.querySelector("#bp-media-library"))}))}();
//# sourceMappingURL=index.js.map
